"use strict";(self.webpackChunknoodl_docs=self.webpackChunknoodl_docs||[]).push([[8153],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),u=l(n),m=o,h=u["".concat(c,".").concat(m)]||u[m]||p[m]||a;return n?r.createElement(h,s(s({ref:t},d),{},{components:n})):r.createElement(h,s({ref:t},d))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=m;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[u]="string"==typeof e?e:o,s[1]=i;for(var l=2;l<a;l++)s[l]=n[l];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},30591:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>l});var r=n(87462),o=(n(67294),n(3905));const a={title:"Geocoder",hide_title:!0},s="Geocoder",i={unversionedId:"modules/mapbox/guides/geocoder",id:"modules/mapbox/guides/geocoder",title:"Geocoder",description:"Mapbox Geocoder API is a geocoding service that allows developers to convert human-readable addresses into geographic coordinates (latitude and longitude) and vice versa. It is a RESTful API that provides geocoding and reverse geocoding services for worldwide locations. The API uses machine learning and other advanced algorithms to provide accurate and relevant results for address searches. Mapbox Geocoder API can be used in a variety of applications, such as location-based services, logistics and delivery management, real estate, and more. It also offers various features such as autocomplete suggestions, batch geocoding, and custom matching parameters, making it a powerful tool for developers to build location-based applications.",source:"@site/library/modules/mapbox/guides/geocoder.md",sourceDirName:"modules/mapbox/guides",slug:"/modules/mapbox/guides/geocoder",permalink:"/2.9/library/modules/mapbox/guides/geocoder",draft:!1,tags:[],version:"current",frontMatter:{title:"Geocoder",hide_title:!0}},c={},l=[{value:"Create a request to Geocoder API",id:"create-a-request-to-geocoder-api",level:2},{value:"Improve the search result",id:"improve-the-search-result",level:3}],d={toc:l},u="wrapper";function p(e){let{components:t,...n}=e;return(0,o.kt)(u,(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"geocoder"},"Geocoder"),(0,o.kt)("p",null,"Mapbox Geocoder API is a geocoding service that allows developers to convert human-readable addresses into geographic coordinates (latitude and longitude) and vice versa. It is a RESTful API that provides geocoding and reverse geocoding services for worldwide locations. The API uses machine learning and other advanced algorithms to provide accurate and relevant results for address searches. Mapbox Geocoder API can be used in a variety of applications, such as location-based services, logistics and delivery management, real estate, and more. It also offers various features such as autocomplete suggestions, batch geocoding, and custom matching parameters, making it a powerful tool for developers to build location-based applications."),(0,o.kt)("h2",{id:"create-a-request-to-geocoder-api"},"Create a request to Geocoder API"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'// Define the expected inputs for the script\nScript.Inputs = {\n  Query: "string",\n};\n\n// Define the expected outputs for the script\nScript.Outputs = {\n  Items: "array",\n  Searched: "signal",\n};\n\n// Set the endpoint URL for the Mapbox geocoding API\nconst ENDPOINT = "https://api.mapbox.com/geocoding/v5/mapbox.places";\n\n// Define an asynchronous function to make the API request\nasync function makeRequest() {\n  // Get the Mapbox access token from Noodl project settings\n  const access_token = Noodl.getProjectSettings().mapboxAccessToken;\n\n  // Encode the search query to be URL-safe\n  const search_text = encodeURIComponent(Script.Inputs.Query);\n\n  // Define query parameters for the API request\n  //\n  // Playground by Mapbox to test out all the features:\n  // https://docs.mapbox.com/playground/geocoding\n  //\n  // Here is a list of all the different possible types:\n  //  - address\n  //  - country\n  //  - region\n  //  - postcode\n  //  - district\n  //  - place\n  //  - neighborhood\n  //  - locality\n  //  - poi\n  const queryParams = {\n    access_token, // Provide the access token\n    proximity: "ip", // Bias results towards user\'s location\n    limit: 5, // Maximum number of results to return\n    types: ["address"].join(","), // Filter results to include only addresses\n    fuzzyMatch: true, // Enable approximate matching\n  };\n\n  // Construct the query string from the query parameters\n  const query = Object.keys(queryParams)\n    .filter((key) => !!queryParams[key]) // Filter out empty values\n    .map(\n      (key) =>\n        `${encodeURIComponent(key)}=${encodeURIComponent(queryParams[key])}`\n    )\n    .join("&");\n\n  // Make the API request and get the response as JSON\n  const response = await fetch(`${ENDPOINT}/${search_text}.json?${query}`);\n  const json = await response.json();\n\n  // Map the API response to an array of search results\n  const items = json.features.map((x) =>\n    Noodl.Object.create({\n      text: x.text,\n      place_name: x.place_name,\n      // Convert the array of [latitude, longitude] to a Geopoint\n      center: { latitude: x.center[0], longitude: x.center[1] },\n    })\n  );\n\n  Script.Outputs.Items = items;\n  Script.Outputs.Searched();\n}\n\nScript.Signals = {\n  Search() {\n    makeRequest();\n  },\n};\n')),(0,o.kt)("h3",{id:"improve-the-search-result"},"Improve the search result"),(0,o.kt)("p",null,"While comparing the built in Geocoder in Mapbox and using this Script.\nThere are a few differences and the result from the Mapbox Geocoder is getting better result."),(0,o.kt)("p",null,"The reason why the results are better is that the parameters are a little different, but in the end they are using the same API endpoints."),(0,o.kt)("p",null,"To make the parameters match, we can make a few changes in this code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const queryParams = {\n  access_token, // Provide the access token\n  proximity: [Script.Inputs.lng, Script.Inputs.lat].join(','), // Bias results towards user's location\n  limit: 5, // Maximum number of results to return\n  language: 'en-GB'\n};\n")),(0,o.kt)("p",null,"The main change here is the ",(0,o.kt)("inlineCode",{parentName:"p"},"proximity")," that we changed to a Geopoint instead of ",(0,o.kt)("inlineCode",{parentName:"p"},"ip"),".\nThis requires 2 new inputs to the Script node, ",(0,o.kt)("inlineCode",{parentName:"p"},"lng")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"lat"),", connected from the Mapbox node center lng and lat position."))}p.isMDXComponent=!0}}]);