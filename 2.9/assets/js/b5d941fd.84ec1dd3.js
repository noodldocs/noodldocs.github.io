"use strict";(self.webpackChunknoodl_docs=self.webpackChunknoodl_docs||[]).push([[4780],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),u=o,m=d["".concat(l,".").concat(u)]||d[u]||h[u]||r;return n?a.createElement(m,i(i({ref:t},p),{},{components:n})):a.createElement(m,i({ref:t},p))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:o,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},72822:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var a=n(87462),o=(n(67294),n(3905));n(53488);const r={title:"OpenAI",hide_title:!0},i="OpenAI",s={unversionedId:"prefabs/openai/README",id:"prefabs/openai/README",title:"OpenAI",description:"This prefab only works on Noodl hosted cloud services.",source:"@site/library/prefabs/openai/README.md",sourceDirName:"prefabs/openai",slug:"/prefabs/openai/",permalink:"/2.9/library/prefabs/openai/",draft:!1,tags:[],version:"current",frontMatter:{title:"OpenAI",hide_title:!0},sidebar:"OpenAISidebar"},l={},c=[{value:"Create Chat Stream",id:"create-chat-stream",level:2}],p={toc:c},d="wrapper";function h(e){let{components:t,...r}=e;return(0,o.kt)(d,(0,a.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"openai"},"OpenAI"),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"This prefab only works on Noodl hosted cloud services.")),(0,o.kt)("p",null,"The ",(0,o.kt)("a",{parentName:"p",href:"https://openai.com"},"OpenAI")," prefab is a great starting point for creating your own chat bots based on the ChatGPT API. This prefab includes a few cloud functions and logic components that can get you started quickly. Here is a quick guide on how to use the prefab to build a very simple chat bot."),(0,o.kt)("p",null,"To be able to follow this guide properly we recommend that you are well versed in a few Noodl concepts already."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Cloud Data"),". You know how to set up cloud services and work with cloud data, start ",(0,o.kt)("a",{parentName:"li",href:"/docs/guides/cloud-data/creating-a-backend"},"here"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Cloud Functions"),", how to create logic that run in the cloud, take a look ",(0,o.kt)("a",{parentName:"li",href:"/docs/guides/cloud-logic/introduction"},"here"),".")),(0,o.kt)("p",null,"Make sure you have a cloud service active for your project. Next you need an account and API key for ",(0,o.kt)("a",{parentName:"p",href:"https://openai.com"},"OpenAI"),"."),(0,o.kt)("h1",{id:"setup"},"Setup"),(0,o.kt)("p",null,"Start by cloning the prefab into your project, you can read more about how prefabs work ",(0,o.kt)("a",{parentName:"p",href:"/docs/guides/user-interfaces/modules"},"here"),". After the prefab is cloned into your project you will see a warning. Don't worry we will sort this out next."),(0,o.kt)("div",{className:"ndl-image-with-background l"},(0,o.kt)("p",null,(0,o.kt)("img",{src:n(67325).Z,width:"437",height:"187"}))),(0,o.kt)("p",null,"First you need to find and add the OpenAI API Key to your cloud services backend. Launch the cloud services dashboard for your project and find your way to the ",(0,o.kt)("strong",{parentName:"p"},"Config")," tab, here you will need to create a new config parameter called ",(0,o.kt)("inlineCode",{parentName:"p"},"OpenAIAPIKey")," (case sensitive) where you need to put the ",(0,o.kt)("strong",{parentName:"p"},"API Key")," from your ",(0,o.kt)("a",{parentName:"p",href:"https://platform.openai.com/account/usage"},"OpenAI Account"),". Then create the config in your cloud service, and make sure that access is restricted to ",(0,o.kt)("strong",{parentName:"p"},"Master Key Only"),". This will keep the API key safe in your cloud service."),(0,o.kt)("div",{className:"ndl-image-with-background xl"},(0,o.kt)("p",null,(0,o.kt)("img",{src:n(50271).Z,width:"546",height:"134"}))),(0,o.kt)("p",null,"Completing this task should remove the warning."),(0,o.kt)("h1",{id:"a-basic-chat"},"A basic chat"),(0,o.kt)("p",null,"Let's take a look at a basic chat. With the setup above in place we can move to the frontend component of the prefab. It includes a very basic chat frontend that you can put into your project as a starting point."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"The cloud functions of the prefab require the user to be logged in so for this very basic example we are expecting there to be a user with username ",(0,o.kt)("inlineCode",{parentName:"p"},"test")," and password ",(0,o.kt)("inlineCode",{parentName:"p"},"test"),". Either create a user with those credentials in your backend, or if you already have users in your app you can modify the example below.")),(0,o.kt)("p",null,"You can find it in the ",(0,o.kt)("inlineCode",{parentName:"p"},"OpenAI")," folder it's called ",(0,o.kt)("inlineCode",{parentName:"p"},"Basic Streaming Chat"),". Drag it into your app and lets review how it works below. "),(0,o.kt)("p",null,"First we keep the chat log in an array called ",(0,o.kt)("inlineCode",{parentName:"p"},"Messages"),", in this example the array is only kept in memory on the client. The content of the array is displayed using a ",(0,o.kt)("a",{parentName:"p",href:"/nodes/ui-controls/repeater"},"Repeater"),"."),(0,o.kt)("div",{className:"ndl-image-with-background xl"},(0,o.kt)("p",null,(0,o.kt)("img",{src:n(21865).Z,width:"549",height:"274"}))),(0,o.kt)("p",null,"The content of the array has the following format, for details please review the ",(0,o.kt)("a",{parentName:"p",href:"https://platform.openai.com/docs/guides/gpt/chat-completions-api"},"OpenAI Documentation"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"[\n    {\n        Role:'system', // this can be any of system, user or assistant\n        Content:'the content of the message',\n    }\n]\n")),(0,o.kt)("p",null,"When starting up the array is initialized with just the system message."),(0,o.kt)("div",{className:"ndl-image-with-background xl"},(0,o.kt)("p",null,(0,o.kt)("img",{src:n(34235).Z,width:"466",height:"343"}))),(0,o.kt)("p",null,"The meat of the chat is represented with these nodes, let's review them in detail."),(0,o.kt)("div",{className:"ndl-image-with-background xl"},(0,o.kt)("p",null,(0,o.kt)("img",{src:n(74645).Z,width:"784",height:"413"}))),(0,o.kt)("p",null,"There are two UI components a ",(0,o.kt)("a",{parentName:"p",href:"/nodes/ui-controls/text-input"},"Text Input")," where the user can input the chat message, and a ",(0,o.kt)("a",{parentName:"p",href:"/nodes/ui-controls/button"},"Button")," that when clicked the message is sent to the OpenAI API. This is done with the cloud function (included in the prefab) ",(0,o.kt)("inlineCode",{parentName:"p"},"OpenAI/Create Chat Stream"),", this function expects the full chat history on the ",(0,o.kt)("inlineCode",{parentName:"p"},"Messages")," input in the format detailed above."),(0,o.kt)("p",null,"So we have simply connected the ",(0,o.kt)("inlineCode",{parentName:"p"},"Messages")," array directly to the input. When the submit button is clicked a function node is called that add the message to the chat history, it has the following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"Noodl.Arrays.Messages = Noodl.Arrays.Messages.concat([{\n    Role:'user',\n    Content:Inputs.Content\n}])\n\nOutputs.Done();\n")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Remember to always create a new array when modifying arrays. This is the only way it will be propagated as a change to the UI.")),(0,o.kt)("p",null,"When the array has been update the cloud function is called, now with the complete chat history. The cloud function will return with a chat stream session and an endpoint that can be used with the ",(0,o.kt)("inlineCode",{parentName:"p"},"Stream Session")," logic component. This component will stream the reply from the AI and emit the content on the ",(0,o.kt)("inlineCode",{parentName:"p"},"Content")," output along with a ",(0,o.kt)("inlineCode",{parentName:"p"},"Changed")," signal when the outputs is updated."),(0,o.kt)("p",null,"In this simple chat example we simply feed it into another function node that appends the message from the AI assistant to the chat history. Here is the code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"let last = Noodl.Arrays.Messages[Noodl.Arrays.Messages.length-1];\n\nif(last.Role !== 'assistant') {\n    Noodl.Arrays.Messages = Noodl.Arrays.Messages.concat([{\n        Role:'assistant',\n        Content:Inputs.Content\n    }])\n}\nelse last.Content = Inputs.Content;\n")),(0,o.kt)("p",null,"It simply checks if the last message on the chat history is an ",(0,o.kt)("inlineCode",{parentName:"p"},"assistant")," type message, if not a new message is added (just like we added user messages above). If there is an ",(0,o.kt)("inlineCode",{parentName:"p"},"assistant")," message at the bottom of the chat history we simply change the content of the message."),(0,o.kt)("p",null,"Changing the chat message history in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Messages")," array will automatically update the user interface so we don't need any additional logic for that."),(0,o.kt)("div",{className:"ndl-image-with-background l"},(0,o.kt)("p",null,(0,o.kt)("img",{src:n(35635).Z,width:"450",height:"376"}))),(0,o.kt)("p",null,"Thats basically it for the frontend of the basic chat. Let's review the cloud function as well."),(0,o.kt)("h2",{id:"create-chat-stream"},"Create Chat Stream"),(0,o.kt)("p",null,"The cloud function is very simple. It just uses the ",(0,o.kt)("inlineCode",{parentName:"p"},"Chat Completion Stream")," logic component which requires a ",(0,o.kt)("inlineCode",{parentName:"p"},"Messages")," input with the same format and an optional ",(0,o.kt)("inlineCode",{parentName:"p"},"User Id")," (this can be used by OpenAI to track misuse of the AI)."),(0,o.kt)("div",{className:"ndl-image-with-background xl"},(0,o.kt)("p",null,(0,o.kt)("img",{src:n(85106).Z,width:"936",height:"424"}))),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"Chat Completion Stream")," creates a stream session with the provided chat history and parameters that can later be used on the frontend with the ",(0,o.kt)("inlineCode",{parentName:"p"},"Stream Session")," logic component. Besides the chat history you have a number of properties you can modify:"),(0,o.kt)("div",{className:"ndl-image-with-background l"},(0,o.kt)("p",null,(0,o.kt)("img",{src:n(29408).Z,width:"294",height:"189"}))),(0,o.kt)("p",null,"Please review the ",(0,o.kt)("a",{parentName:"p",href:"https://platform.openai.com/docs/guides/gpt/chat-completions-api"},"OpenAI Documentation")," for more details on these properties."),(0,o.kt)("p",null,"The prefab also includes a ",(0,o.kt)("inlineCode",{parentName:"p"},"Completion Stream")," and an accompanying cloud function ",(0,o.kt)("inlineCode",{parentName:"p"},"Create Completion Stream"),", this uses the completion OpenAI API that only accepts a single ",(0,o.kt)("inlineCode",{parentName:"p"},"prompt")," input and now a full chat history. More information on the API ",(0,o.kt)("a",{parentName:"p",href:"https://platform.openai.com/docs/guides/gpt/completions-api"},"here"),". It aslo has slightly different parameters."))}h.isMDXComponent=!0},53488:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(67294);function o(e){navigator.clipboard?navigator.clipboard.writeText(e).then((function(){console.log("Async: Copying to clipboard was successful!")}),(function(e){console.error("Async: Could not copy text: ",e)})):function(e){var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{var n=document.execCommand("copy")?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+n)}catch(a){console.error("Fallback: Oops, unable to copy",a)}document.body.removeChild(t)}(e)}function r(e){return a.createElement("button",{className:"ndl-copy-nodes-button",onClick:()=>{return t=e.json,void o(JSON.stringify(t));var t}})}},85106:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/chat-cf-1-2f24e14fcf2428dd1354a9bda5072046.png"},29408:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/chat-cf-2-40d377e27c2a08421893cc668117e3e1.png"},35635:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/chat-ui-1-f30b992e1af1c407814f49e11766e3d4.png"},21865:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/chatnodes-1-eb157f10b3cd417a95d97f74a2290a65.png"},34235:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/chatnodes-2-73d6476f215858648cb54725acc950df.png"},74645:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/chatnodes-3-1fe5dbb9bff8a5a6b6748b49dcb14bec.png"},50271:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/config-param-4f7107faf45da15ff8c8f0896bdc0e1c.png"},67325:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/warnings-f39ea1da02561c9efadc140853b716bc.png"}}]);