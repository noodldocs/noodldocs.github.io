<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-library docs-doc-id-prefabs/stripe/README">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="search" type="application/opensearchdescription+xml" title="Noodl" href="/2.9/opensearch.xml">
<link rel="alternate" type="application/json" href="/2.9/whats-new/feed.json" title="Noodl JSON Feed">
<!-- Google Tag Manager -->
    <script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-P4LSJL4",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
    <!-- End Google Tag Manager --><title data-rh="true">Stripe | Noodl</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.noodl.net/2.9/library/prefabs/stripe/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:image" content="https://docs.noodl.net/noodl-docs.png"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-library-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-library-current"><meta data-rh="true" property="og:title" content="Stripe | Noodl"><meta data-rh="true" name="description" content="Accepting payments and managing subscriptions is an important part of many digital products and when building in Noodl this is best done using Stripe, to go-to service for integrating payment into apps. This prefab and this guide will cover some of the key aspects of enabling you to accept payments from your users."><meta data-rh="true" property="og:description" content="Accepting payments and managing subscriptions is an important part of many digital products and when building in Noodl this is best done using Stripe, to go-to service for integrating payment into apps. This prefab and this guide will cover some of the key aspects of enabling you to accept payments from your users."><link data-rh="true" rel="icon" href="/2.9/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.noodl.net/2.9/library/prefabs/stripe/"><link data-rh="true" rel="alternate" href="https://docs.noodl.net/2.9/library/prefabs/stripe/" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.noodl.net/2.9/library/prefabs/stripe/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://D29X2LNM4J-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/2.9/assets/css/styles.a6482fe6.css">
<link rel="preload" href="/2.9/assets/js/runtime~main.94b0c7bf.js" as="script">
<link rel="preload" href="/2.9/assets/js/main.4b8b3b43.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/2.9/"><div class="navbar__logo"><img src="/2.9/img/logo.svg" alt="Noodl Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/2.9/img/logo.svg" alt="Noodl Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Docs</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/2.9/docs/learn">Learn</a><a class="navbar__item navbar__link" href="/2.9/nodes/overview">Node reference</a><a class="navbar__item navbar__link" href="/2.9/library/overview">Library</a><a class="navbar__item navbar__link has-divider" href="/2.9/javascript/overview">Javascript</a><a href="https://discord.com/invite/23xU2hYrSJ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link is-discord">Discord</a><a href="https://console.noodl.net/#/signup" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link is-download-button">Download</a><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><div class="search-bar-outer"><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/2.9/library/prefabs/stripe/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/2.9/library/prefabs/overview">Back to prefabs</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="Root_noPZ"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Stripe</h1><p>Accepting payments and managing subscriptions is an important part of many digital products and when building in Noodl this is best done using <strong>Stripe</strong>, to go-to service for integrating payment into apps. This prefab and this guide will cover some of the key aspects of enabling you to accept payments from your users. </p><p>First you need to create an account and make sure you have access to the <a href="https://dashboard.stripe.com" target="_blank" rel="noopener noreferrer">Stripe Dashboard</a>, you don&#x27;t need a fully approved account to complete this guide, it&#x27;s actually preferable that you start with the test version of your account.</p><p>To be able to follow this guide properly we recommend that you are well versed in a few Noodl concepts already.</p><ul><li><strong>Cloud Data</strong>. You know how to set up cloud services and work with cloud data, start <a href="/2.9/docs/guides/cloud-data/creating-a-backend">here</a>.</li><li><strong>Cloud Functions</strong>, how to create logic that run in the cloud, take a look <a href="/2.9/docs/guides/cloud-logic/introduction">here</a>.</li><li><strong>Pages and Navigation</strong>, how to create pages and navigation, start <a href="/2.9/docs/guides/navigation/basic-navigation">here</a>.</li><li><strong>User Management</strong>, you need to have an app where you can create new users and log them in, start <a href="/2.9/nodes/data/user/sign-up">here</a></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="setup">Setup<a class="hash-link" href="#setup" title="Direct link to heading">​</a></h2><p>After installing the prefab you will find a folder of components both on your frontend and in your cloud functions called <strong>Stripe</strong>, in these folders you will find the good stuff we will use in this guide. But first you must complete the setup.</p><p>Launch the cloud services dashboard for your project and find your way to the <strong>Config</strong> tab, here you will need to create a new config parameter called <code>StripeAPIKey</code> (case sensitive) where you need to put the <strong>Secret Key</strong> from your <a href="https://dashboard.stripe.com" target="_blank" rel="noopener noreferrer">Stripe Dashboard</a>. Look for this section in <strong>Stripe</strong>, important it&#x27;s the <strong>Secret Key</strong> that you need.</p><div class="ndl-image-with-background l"><p><img loading="lazy" src="/2.9/assets/images/stripe-key-83720ca2f0d6ed613783598363b9f9a6.png" width="808" height="256" class="img_E7b_"></p></div><p>Then create the config in your cloud service, and make sure that access is restricted to <strong>Master Key Only</strong>. This will keep the API key safe in your cloud service.</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.9/assets/images/config-param-97fb630d34d408c3f10ab26cc22e5312.png" width="1962" height="110" class="img_E7b_"></p></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="accepting-a-one-time-payment">Accepting a one time payment<a class="hash-link" href="#accepting-a-one-time-payment" title="Direct link to heading">​</a></h2><p>Let&#x27;s start with the basic example of your user buying a product from your application with a one time payment. First you need to make sure you have <a href="https://support.stripe.com/questions/how-to-create-products-and-prices" target="_blank" rel="noopener noreferrer">created the product in stripe</a> and that it has a one time price. Find the <code>Price Id</code> in your dashboard, it will look like this.</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.9/assets/images/stripe-price-id-f7239b73ba5db41fa25365c3d6a74981.png" width="1066" height="136" class="img_E7b_"></p></div><p>Copy it for we will use it in a bit. Let&#x27;s say you are creating a game where you can buy virtual products, and you have a checkout screen that looks something like this:</p><div class="ndl-image-with-background"><p><img loading="lazy" src="/2.9/assets/images/game-checkout-56b9749638753bf9f4fa1e69168508d6.png" width="404" height="514" class="img_E7b_"></p></div><p>When the user clicks the <strong>Checkout</strong> button you will use the <strong>Buy Products</strong> logic component that is part of the prefab. It will redirect the user to a checkout page that is hosted by stripe where the user can provide credit card details and complete the purchase.</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.9/assets/images/buy-products-nodes-90a7d07bb4ddb61f156f26f57d9b39d2.png" width="1100" height="696" class="img_E7b_"></p></div><p>You need to send a signal to <strong>Do</strong> when you want the redirect to happen and you need to provide an array of <strong>Items</strong> that Stripe should prompt the user to pay for. This is an array of objects, one for each product type to purchase (kind of like a checkout cart). The function node in the graph above have the following short code:</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#bfc7d5;background-color:#292d3e"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token maybe-class-name">Outputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">Items</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token literal-property property">PriceId</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;your-price-id-from-stripe&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token literal-property property">Quantity</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>You also need to provide a payment <strong>Owner Id</strong>, this is simply an <strong>Id</strong> that you will need later to fulfill the purchase. In this case we are going to assign a magic sword item to our user so we need to pass in the user as the owner of the payment. More on this later under the fulfilment topic.</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.9/assets/images/payment-owner-id-2f6160a15bc673b6ef2e7c51b57a90d9.png" width="1180" height="596" class="img_E7b_"></p></div><p>This will open a new tab with the stripe checkout page where the user can complete the purchase. When the user succeeds, or if the payment is cancelled <strong>Stripe</strong> will redirect back to your application. This is done using two redirect urls. You will need to add these to the <strong>Config</strong> of your application, the exact values should match your domain when you have deployed the app, but for now you can just put in any value:</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.9/assets/images/checkout-callbacks-config-ef84f76b60d91364c3985e45f2ffd592.png" width="1958" height="208" class="img_E7b_"></p></div><p>Actually when running locally (while developing your app in the editor) they will get a different value, to customize this value look in the <strong>Stripe / Settings</strong> component among your cloud functions.</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.9/assets/images/checkout-callbacks-4f1940b152e6c054d8f43fd1e33d6b46.png" width="1728" height="616" class="img_E7b_"></p></div><ul><li>The <code>Checkout Success Url</code> is overridden when working locally and set to <code>http://localhost:8574/checkout-success</code></li><li>The <code>Checkout Cancel Url</code> is overridden when working locally and set to <code>http://localhost:8574/checkout-cancel</code></li></ul><p>You need to create pages that map to these urls, or update the two urls to match your application. To learn more about how to use configurations in your app check out the <a href="/2.9/nodes/data/cloud-data/config">Config</a> node.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If things don&#x27;t work as expected (there are many things that can go wrong), the <strong>Developer</strong> part of the <strong>Stripe Dashboard</strong> is a good place to start looking. Here you can see all latest requests made and it will show you errors and might give you clues to what went wrong.</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="fulfillment-and-webhooks">Fulfillment and webhooks<a class="hash-link" href="#fulfillment-and-webhooks" title="Direct link to heading">​</a></h2><p>Now when the user has completed the checkout flow <strong>Stripe</strong> will notify your application that you can fulfill the request (in this case, give the user the magic sword). This is done using something called <strong>Webhooks</strong>, for us this means that <strong>Stripe</strong> will call a <strong>Cloud Functions</strong> of our choosing to let us know that the payment was successful. First you need to set up the webhook, and when developing <strong>Stripe</strong> has a neat tool that will let you test the entire flow in the Noodl editor before deploying.</p><p>Visit <a href="https://dashboard.stripe.com/test/webhooks/create?endpoint_location=local" target="_blank" rel="noopener noreferrer">this page</a> of your <strong>Stripe Dashboard</strong> to install the tools needed on your computer and perform the setup. Now when starting the tool you should use the following command:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#bfc7d5;background-color:#292d3e"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ stripe listen --forward-to localhost:8577/functions/stripe-webhook</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Next you will need to create a cloud function called <code>stripe-webhook</code> (small case), this is the function that will be called when the checkout session is completed. Start by adding a <strong>Stripe / Events / Process Stripe Payment Event</strong> logic component to your function like this:</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.9/assets/images/stripe-webhook-1-8a0193d46c7b655f55c2c4077cd7e4e7.png" width="990" height="660" class="img_E7b_"></p></div><p>It&#x27;s good practice to always return a successful response right away so stripe will be happy, then we can perform the task in the background. Also make sure your cloud function can be called without authorization since it will be called by <strong>Stripe</strong> and not be a logged in user in your app, edit the properties of the <strong>Request</strong> node.</p><div class="ndl-image-with-background l"><p><img loading="lazy" src="/2.9/assets/images/allow-unauth-d4a65095ca046013892fc2c092f6ea36.png" width="754" height="180" class="img_E7b_"></p></div><p>When the payment is completed successfully a <strong>Payment Completed</strong> signal will be sent from the <strong>Process Stripe Payment Event</strong> node. We can use this to create our virtual magic sword and give it to our user. Here are a few important outputs that we get with the signal.</p><ul><li><code>Payment Owner Id</code> This is the <strong>Id</strong> that we provided when starting the checkout session above with the <strong>Buy Products</strong> action. In this case it will point to the user making the purchase so we can use it when creating the sword.</li><li><code>Items</code> is an array with objects containing the items that was purchased (same as was sent into the <strong>Buy Products</strong> action) but augmented with some important data, this is what they look like:</li></ul><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#bfc7d5;background-color:#292d3e"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token maybe-class-name">Quantity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// The number of this item</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token maybe-class-name">PriceId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// The price it was puchased at</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token maybe-class-name">ProductId</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// The Id of the product from your stripe dashboard</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Let&#x27;s say that we have a class of record in our cloud service called <strong>Product</strong>, here we will create items that have a <strong>productId</strong> that we get from stripe (this will tell us what was purchased), and a pointer to a user called <strong>ownerId</strong> so that later we can query all products that a user has purchased. We can hook it up like this:</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.9/assets/images/stripe-webhook-2-9820e7f0c473d3be372cff42f94ac81b.png" width="1396" height="448" class="img_E7b_"></p></div><p>The little function node is used to extract the first product id from the <strong>Items</strong> array with the following little snippet:</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#bfc7d5;background-color:#292d3e"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">Inputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">Items</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token maybe-class-name">Outputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">ProductId</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Inputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">Items</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">ProductId</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>That&#x27;s it, now we can sell virtual magic swords to our users. You can test out the payment flow in your application when running on your desktop by opening a browser and navigating to <code>http://localhost:8574</code> where Noodl serves your application while running locally.</p><p>When you complete the payment flow you should see the cloud function light up as the signals is triggered and the data flows through the graph. You can also use this to find any problems by inspecting the data on the connections.</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.9/assets/images/inspect-webhook-86c026bdd0a00689e5604d1554147072.png" width="1412" height="420" class="img_E7b_"></p></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The <strong>Product Id</strong> from stripe (that you can find in your <a href="https://dashboard.stripe.com" target="_blank" rel="noopener noreferrer">Stripe Dashboard</a>) is a unique identifier for the product, it&#x27;s good to use this same <strong>Id</strong> in your app to identify items of purchase.</p></div></div><p>When you deploy your application you need to make sure that the two redirect urls in your config above points to the correct domain, customer or sandbox. And most important you need to provide the deployed webhook function url to <strong>Stripe</strong>. First, you need to find the endpoint of your cloud services that you will use for your deployed app, go to the <strong>Cloud Services</strong> sidebar tab and then <strong>Manage cloud service</strong>.</p><div class="ndl-image-with-background l"><p><img loading="lazy" src="/2.9/assets/images/cs-manage-1-f35f6d32bc7f22d8ac89cb9c2f4860bb.png" width="600" height="470" class="img_E7b_"></p></div><p>This will show the follow popup, here you are looking for the <strong>Endpoint</strong> url.</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.9/assets/images/cs-manage-2-aeb5987849d73b0f2320daebe7574f02.png" width="1654" height="682" class="img_E7b_"></p></div><p>Now the endpoint for your <strong>Webhook</strong> function will be (replacing <code>xyz</code> and <code>123</code> with the values from your endpoint in the dialog above):</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#bfc7d5;background-color:#292d3e"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">https://backend.noodl.cloud/xyz/123/functions/stripe-webhook</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>With that url in hand go to the <a href="https://dashboard.stripe.com/test/webhooks/create" target="_blank" rel="noopener noreferrer">Stripe Dashboard</a> to add a new webhook endpoint. You also need to tell stripe what events you are interested in receiving. For one time payments you only need:</p><ul><li><code>checkout.session.completed</code> you will find it under the <strong>Checkout</strong> tab.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="storing-the-customer-id">Storing the Customer Id<a class="hash-link" href="#storing-the-customer-id" title="Direct link to heading">​</a></h2><p>The way we have set it up now <strong>Stripe</strong> will create a new customer for every checkout session, although this works it will create a lot of customers in your stripe dashboard and the user will have to fill out credit card details every time they make a new purchase. To avoid this we can store the <strong>Customer Id</strong> from <strong>Stripe</strong> in our app database and in later checkouts, let <strong>Stripe</strong> know it&#x27;s the same customer. In this case, a customer maps to a <strong>User</strong> in our database, so let&#x27;s create a new property on our user record called <strong>stripeCustomerId</strong> make sure it has the <strong>String</strong> type.</p><p>Then in your <strong>stripe-webhook</strong> cloud function, hook it up so the <code>Customer Id</code>received along with the <strong>Payment Completed</strong> signal is stored in the user record (remember we used the <strong>Payment Owner Id</strong> to keep the user when starting the checkout process).</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.9/assets/images/stripe-webhook-3-97778acee407ee72f2074a5c409ddd31.png" width="1300" height="772" class="img_E7b_"></p></div><p>Now after the user has made one purchase we can use the <strong>stripeCustomerId</strong> property when initiating new checkout sessions. Add these connections to where you initiate the session with the <strong>Buy Products</strong> action.</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.9/assets/images/customer-id-connect-0de8f5fce739e0a0122401cc8da8c234.png" width="1180" height="828" class="img_E7b_"></p></div><p>You can also provide a <code>Customer Name</code>and a <code>Customer Email</code> if you have  them, in that case they will be prefilled in the form of the checkout session. With this hooked up, try the new flow two times and the second time you should see that it retains your details.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="subscriptions">Subscriptions<a class="hash-link" href="#subscriptions" title="Direct link to heading">​</a></h2><p>With this prefab you can also build applications that offer subscriptions or plans for your users. It works much similar to above so make sure you have completed all the steps for one time payments as we won&#x27;t go into as much more detail here.</p><p>Like for one time payments you need products set up and you need prices for your products. A product with a recurring price corresponds to a plan type (so maybe one for Basic, Pro etc), and a product can have several prices and billing periods. If there is no plan, we assume that your are on the <code>free</code> plan initially. So to get the prefabs working properly you need to start by initializing the <code>Plans</code> array that should contain all your plans, this can be done e.g. in your home <code>App</code> component.</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.9/assets/images/init-plans-3e0b5d06919d46493dfa8146dc8e7aaa.png" width="1092" height="406" class="img_E7b_"></p></div><p>You need the array to follow a certain schema, this is an example of what you could put in a function node as above:</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#bfc7d5;background-color:#292d3e"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token maybe-class-name">Outputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">Items</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token literal-property property">Name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Free&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token literal-property property">Desc</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Description&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token literal-property property">id</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;free&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token literal-property property">ProductId</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;xyz&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token literal-property property">Name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Basic&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token literal-property property">Desc</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;With the basic plan you get features A,B,C. Its billed monthly.&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token literal-property property">id</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;the-price-id-from-stripe-for-this-plan&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token literal-property property">Period</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;month&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token literal-property property">Price</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;$99&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token literal-property property">Details</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string-property property">&#x27;Text&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Sharing Tools&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string-property property">&#x27;InPlan&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string-property property">&#x27;Text&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Design Tools&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string-property property">&#x27;InPlan&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string-property property">&#x27;Text&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Private Messages&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string-property property">&#x27;InPlan&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ... more details</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// .... more plans</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>You need the <code>free</code> product in there (as this will be the default displayed if there is no current subscription) and then one entry for each subscription product and price. The prefabs supports filtering on <code>month</code> and <code>year</code> billing periods so you can tag your entries in the array. Some notes:</p><ul><li><code>Details</code> is an array of features for your plan. You can supply this and it will be shown in the <code>Plan Picker</code> visual component that you can use if you like. You can provide a <strong>Text</strong> and <strong>IsPlan</strong> which is a boolean indicating if this specific feature is in the plan or not.</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>In the example below we are going to assume that the current <strong>User</strong> is the subscription owner, but in many cases maybe it will be a different record, such an <strong>Orginization</strong> or a <strong>Team</strong>. You would use the same pattern as below just with a different record class. In that case the <strong>Orginization</strong> or <strong>Team</strong> would be the customer so that is where you would store the <strong>stripeCustomerId</strong> and <strong>plan</strong>.</p></div></div><p>First let&#x27;s use a handy little visual component to show the current plan, it&#x27;s called <code>Current Plan Badge</code> and can be found in the <code>Stripe/Subscriptions</code> folder on your frontend. You can put the badge on a page where you will show the current plan and hook it up as below, as an example.</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.9/assets/images/current-plan-badge-1-1f464416b1f23e4180b42da8f1073e13.png" width="1108" height="670" class="img_E7b_"></p></div><p>The most important thing is to hook up the <strong>stripeCustomerId</strong> from your user (or whatever record you use as subscription owner). This is needed to fetch the current plan and show it. There are a few good to know signals sent from this component.</p><ul><li><strong>Upgrade</strong> This is sent if the user clicks the upgrade button. In this case we navigate to new page where we will show all the plans you can upgrade to. More on that later.</li><li><strong>Plan Canceled</strong> A signal is sent here if the plan was canceled.</li><li><strong>Plan Renewed</strong> A signal is sent here if the plan was renewed.</li><li><strong>Failure</strong> A signal is sent here if an operation failed, the error can be found on the <strong>Error</strong> output.</li></ul><p>This is what it looks like:</p><div class="ndl-image-with-background l"><p><img loading="lazy" src="/2.9/assets/images/current-plan-badge-2-c29798c739bfee7df5819997b0c6c727.png" width="1088" height="600" class="img_E7b_"></p></div><p>However when you have a new user they will not have a plan, so it will display the free plan and ask to upgrade, in this example we navigate to a new page to show all options.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="buying-a-plan">Buying a plan<a class="hash-link" href="#buying-a-plan" title="Direct link to heading">​</a></h2><p>When buying a plan we can use another handy visual component on your frontend called <code>Stripe/Subscriptions/Plan Picker</code>. Simply put that on a page and hook it up as shown below:</p><div class="ndl-image-with-background l"><p><img loading="lazy" src="/2.9/assets/images/plan-picker-1-385d125c96b9c47d01c010ab9c3e6bd3.png" width="1024" height="452" class="img_E7b_"></p></div><p>A few important notes on this. First we connect the <strong>stripeCustomerId</strong> like before, this allows the component to fetch the current plan and also to simply checkout by allowing <strong>Stripe</strong> to save customer info in the checkout process. Furthermore we need to provide a subscription owner id via the <strong>Owner Id</strong> input, just like above this will be used in the <strong>Webhook</strong> to assign the plan to the correct record. In this case we are using the <strong>User</strong> record as the subscription owner. This will result in something like this:</p><div class="ndl-image-with-background l"><p><img loading="lazy" src="/2.9/assets/images/plan-picker-2-738e3c47a4f7dfbe5eab8f1edddb7671.png" width="1188" height="716" class="img_E7b_"></p></div><p>When the <strong>Upgrade</strong> button is clicked, the user will be redirected to the <strong>Stripe</strong> checkout flow just like for one time payments, and redirected back to your application using the same process.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="subscription-fulfillment">Subscription fulfillment<a class="hash-link" href="#subscription-fulfillment" title="Direct link to heading">​</a></h2><p>Just like for one time payments stripe will alert us using the <strong>Webhook</strong> when we receive changes in subscriptions. This time we are going to use the <code>Stripe/Events/Process Stripe Subscription Event</code> component. This will emit signals on important events, namely when a subscriptions is started, updated or deleted. </p><p>First we create a new property on our <strong>User</strong> record in the cloud services dashboard. We call it <code>plan</code> and give it the <strong>String</strong> type, in this property we will store the current plan so we can use it to determine which features should be available in our application. Here is a simple way to hook it up so that we keep track of the current plan the user is subscribed to.</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.9/assets/images/stripe-webhook-4-40de7198849e7184dd366b2fc1987f34.png" width="1740" height="740" class="img_E7b_"></p></div><p>Let&#x27;s review the three signals a bit:</p><ul><li><strong>Subscription Created</strong> This is emited when a subscription is successfully bought, here we store the <strong>Customer Id</strong> with the record pointed to by <strong>Subscription Owner Id</strong>, which in this case is a <strong>User</strong> record. We also store the <strong>Product Id</strong> of the plan. We can use this <strong>Id</strong> in our user to determine which features should be available in our application.</li><li><strong>Subscription Updated</strong> A signal is emitted here if the user updates a plan, so we do the same as when created. We store the <strong>Product Id</strong> of the plan, so we can serve the corresponding features in our application.</li><li><strong>Subscription Deleted</strong> Finally, a signal is sent here if the subscription ends. Here we should revert back to the free plan. We do this using the <strong>Set Record Properties</strong> node on the subscription owner (the user) and by specifying <code>free</code> for the plan.</li></ul><div class="ndl-image-with-background l"><p><img loading="lazy" src="data:image/png;base64,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" width="608" height="100" class="img_E7b_"></p></div><p>There you go, that is all needed to build a subscription purchase and management flow.</p><p>One final notice, when you register your deployed webhook with stripe (as described above, in the <a href="https://dashboard.stripe.com/test/webhooks/create" target="_blank" rel="noopener noreferrer">Stripe Dashboard</a>), make sure to listen to these events, you find the under the <strong>Customer</strong> section:</p><ul><li><p><code>customer.subscription.created</code></p></li><li><p><code>customer.subscription.updated</code></p></li><li><p><code>customer.subscription.deleted</code></p></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="invoices">Invoices<a class="hash-link" href="#invoices" title="Direct link to heading">​</a></h2><p>When your users are subscribed to plans and hopefully paying their bills they might need to viewer invoices and collect receipts. You can have <strong>Stripe</strong> email your customers when an invoice is successfully paid, but it might also be good to show a list in the billing part of your application. You can do this with the <code>Stripe/List Invoices</code> cloud function as shown below:</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.9/assets/images/list-invoices-ba6a1e4a5a792ee06ef5b22194f43e7a.png" width="1586" height="610" class="img_E7b_"></p></div><p>Make sure you provide the <strong>Stripe Cusomter Id</strong> that you should have stored in the previous steps. The array returned will have the following schema:</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#bfc7d5;background-color:#292d3e"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token literal-property property">id</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token literal-property property">Status</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;paid&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Check the stripe documentation for possible invoice statuses</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token literal-property property">ManageUrl</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://...&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// An url where you can redirect the user to manage the invoice</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token literal-property property">PdfUrl</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://...&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// An url where you can redirect the user to download the invoice as PDF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token literal-property property">PeriodStart</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2022-12-08T14:38:50.000Z&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Start of the invoice period</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token literal-property property">PeriodEnd</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2022-12-08T14:38:50.000Z&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// End of period</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token literal-property property">AmountDue</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">3500</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token literal-property property">AmountPaid</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">3500</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token literal-property property">Currency</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;usd&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>I hope you have enjoyed this guide and thay you have some tools to start building great payment capabilities to your apps using <strong>Stripe</strong>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a></li><li><a href="#accepting-a-one-time-payment" class="table-of-contents__link toc-highlight">Accepting a one time payment</a></li><li><a href="#fulfillment-and-webhooks" class="table-of-contents__link toc-highlight">Fulfillment and webhooks</a></li><li><a href="#storing-the-customer-id" class="table-of-contents__link toc-highlight">Storing the Customer Id</a></li><li><a href="#subscriptions" class="table-of-contents__link toc-highlight">Subscriptions</a></li><li><a href="#buying-a-plan" class="table-of-contents__link toc-highlight">Buying a plan</a></li><li><a href="#subscription-fulfillment" class="table-of-contents__link toc-highlight">Subscription fulfillment</a></li><li><a href="#invoices" class="table-of-contents__link toc-highlight">Invoices</a></li></ul></div></div></div></div></div></main></div></div></div>
<script src="/2.9/assets/js/runtime~main.94b0c7bf.js"></script>
<script src="/2.9/assets/js/main.4b8b3b43.js"></script>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P4LSJL4" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) --></body>
</html>