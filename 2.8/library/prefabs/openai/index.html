<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-library docs-doc-id-prefabs/openai/README">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">OpenAI | Noodl</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.noodl.net/2.8/library/prefabs/openai/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:image" content="https://docs.noodl.net/noodl-docs.png"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-library-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-library-current"><meta data-rh="true" property="og:title" content="OpenAI | Noodl"><meta data-rh="true" name="description" content="The OpenAI prefab is a great starting point for creating your own ChatBots based on the ChatGPI API. This prefab includes a few cloud functions and logic components that can get you started quickly. Here is a quick guide on how to use the prefab to build a very simple chat bot."><meta data-rh="true" property="og:description" content="The OpenAI prefab is a great starting point for creating your own ChatBots based on the ChatGPI API. This prefab includes a few cloud functions and logic components that can get you started quickly. Here is a quick guide on how to use the prefab to build a very simple chat bot."><link data-rh="true" rel="icon" href="/2.8/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.noodl.net/2.8/library/prefabs/openai/"><link data-rh="true" rel="alternate" href="https://docs.noodl.net/2.8/library/prefabs/openai/" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.noodl.net/2.8/library/prefabs/openai/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://D29X2LNM4J-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Noodl" href="/2.8/opensearch.xml">




<link rel="alternate" type="application/json" href="/2.8/whats-new/feed.json" title="Noodl JSON Feed">

<!-- Google Tag Manager -->
    <script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-P4LSJL4",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
    <!-- End Google Tag Manager --><link rel="stylesheet" href="/2.8/assets/css/styles.ade92cfe.css">
<link rel="preload" href="/2.8/assets/js/runtime~main.a64c9ce0.js" as="script">
<link rel="preload" href="/2.8/assets/js/main.91e3c642.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/2.8/"><div class="navbar__logo"><img src="/2.8/img/logo.svg" alt="Noodl Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/2.8/img/logo.svg" alt="Noodl Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Docs</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/2.8/docs/learn">Learn</a><a class="navbar__item navbar__link" href="/2.8/nodes/overview">Node reference</a><a class="navbar__item navbar__link" href="/2.8/library/overview">Library</a><a class="navbar__item navbar__link has-divider" href="/2.8/javascript/overview">Javascript</a><a href="https://discord.com/invite/23xU2hYrSJ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link is-discord">Discord</a><a href="https://console.noodl.net/#/signup" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link is-download-button">Download</a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><div class="search-bar-outer"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/2.8/library/prefabs/openai/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/2.8/library/prefabs/overview">Back to prefabs</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="Root_noPZ"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>OpenAI</h1><p>The <a href="https://openai.com" target="_blank" rel="noopener noreferrer">OpenAI</a> prefab is a great starting point for creating your own ChatBots based on the ChatGPI API. This prefab includes a few cloud functions and logic components that can get you started quickly. Here is a quick guide on how to use the prefab to build a very simple chat bot.</p><p>To be able to follow this guide properly we recommend that you are well versed in a few Noodl concepts already.</p><ul><li><strong>Cloud Data</strong>. You know how to set up cloud services and work with cloud data, start <a href="/2.8/docs/guides/cloud-data/creating-a-backend">here</a>.</li><li><strong>Cloud Functions</strong>, how to create logic that run in the cloud, take a look <a href="/2.8/docs/guides/cloud-logic/introduction">here</a>.</li></ul><p>Make sure you have a cloud service active for your project. Next you need an account and API key for <a href="https://openai.com" target="_blank" rel="noopener noreferrer">OpenAI</a>.</p><h1>Setup</h1><p>Start by cloning the prefab into your project, you can read more about how prefabs work <a href="/2.8/docs/guides/user-interfaces/modules">here</a>. After the prefab is cloned into your project you will see a bunch of warnings. Don&#x27;t worry we will sort these out next.</p><div class="ndl-image-with-background l"><p><img loading="lazy" src="/2.8/assets/images/warnings-8f7e089f6b9b65c7a74790a779de49b3.png" width="461" height="180" class="img_ev3q"></p></div><p>First you need to find and add the OpenAI API Key to your cloud services backend. Launch the cloud services dashboard for your project and find your way to the <strong>Config</strong> tab, here you will need to create a new config parameter called <code>OpenAIAPIKey</code> (case sensitive) where you need to put the <strong>API Key</strong> from your <a href="https://platform.openai.com/account/usage" target="_blank" rel="noopener noreferrer">OpenAI Account</a>. Then create the config in your cloud service, and make sure that access is restricted to <strong>Master Key Only</strong>. This will keep the API key safe in your cloud service.</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.8/assets/images/config-param-4f7107faf45da15ff8c8f0896bdc0e1c.png" width="546" height="134" class="img_ev3q"></p></div><p>Next you need to create two record classes in your cloud services, you can learn more about that <a href="/2.8/docs/guides/cloud-data/creating-a-class">here</a>. You need these two classes and properties (make sure you use the exact names, case sensitive):</p><ul><li><strong>OpenAIChat</strong> Create this class and add a single property, a pointer to the <code>_User</code> class and call it <strong>User</strong>.</li><li><strong>OpenAIChatMessages</strong> Create this class and add three properties, two strings <strong>Role</strong> and <strong>Content</strong>, and a pointer to the <code>OpenAIChat</code> class you just created and call it <strong>Chat</strong>.</li></ul><p>Completing these tasks should remove all warnings from your project and we can start building the first basic chat.</p><h1>A basic chat</h1><p>Let&#x27;s take a look at a basic chat. With the setup above in place we can move to the frontend component of the prefab. It includes a very basic chat frontend that you can put into your project as a starting point.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>The cloud functions of the prefab require the user to be logged in so for this very basic example we are expecting there to be a user with username <code>test</code> and password <code>test</code>. Either create a user with those credentials in your backend, or if you already have users in your app you can modify the example below.</p></div></div><p>You can find it in the <code>OpenAI</code> folder it&#x27;s called <code>Basic Chat</code>. Drag it into your app and lets review how it works below. Here is it&#x27;s content.</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.8/assets/images/basicchat-a1197fb4d53331085c0fc35e67627730.png" width="1672" height="1008" class="img_ev3q"></p></div><ol><li><p>When the parent group node is mounted (shown on screen) we log in with the test user (look at the note above). Once we have credentials we call the first cloud function <code>OpenAI/Create New Chat</code>. We will review it in more detail below but this creates a new chat record, <strong>OpenAIChat</strong>, for us and some initial messages.</p></li><li><p>When a new chat has been succesfully created we use the <strong>Id</strong> of the new chat to query all messages using the <a href="/2.8/nodes/data/cloud-data/query-records">Query Records</a> set to the <strong>OpenAIChatMessages</strong> record class. We user a filter to only get the messages from the new chat, and we sort them in the right order. These are the properties of the query records node:</p></li></ol><div class="ndl-image-with-background l"><p><img loading="lazy" src="/2.8/assets/images/filters-and-sort-5bf9936ff4ba1da37367920e14e05ec7.png" width="600" height="604" class="img_ev3q"></p></div><ol start="3"><li>The returned chat messages are then fed into a <a href="/2.8/nodes/ui-controls/repeater">Repeater</a> that displays a list item for each chat message. This is what the simple chat frontend looks like:</li></ol><div class="ndl-image-with-background l"><p><img loading="lazy" src="/2.8/assets/images/basic-chat-ui-95acd5a027bf33003118cde0bb78c851.png" width="822" height="578" class="img_ev3q"></p></div><ol start="4"><li>Finally when the submit button is clicked the cloud function <code>OpenAI/Send Message</code> is called with the content of the text input and the the <strong>Id</strong> of the chat record. When the function has completed, the messages are queried again and displayed in the list. Try it out!</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-new-chat">Create new chat<a href="#create-new-chat" class="hash-link" aria-label="Direct link to Create new chat" title="Direct link to Create new chat">​</a></h2><p>Lets review some of the cloud functions so you can customize and build your own AI driven chat bot applications. There are two cloud functions used here, <code>OpenAI/Create New Chat</code> and <code>OpenAI/Send Message</code>. The first function creates a new chat object and is actually mostly Noodl cloud data operations:</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.8/assets/images/create-new-chat-1-161336e3429f86bf8a914125ee273002.png" width="1714" height="886" class="img_ev3q"></p></div><ol><li><p>When the function is started it first creates a new chat record <code>OpenAIChat</code> this is the parent record that we use to keep track of all messages. </p></li><li><p>Next it creates the system message. That is the first message of the chat and it tells the chat bot how it should behave. You can provide your own message by changing the <code>String</code> node. All messages are records of type <code>OpenAIChatMessages</code> and we provide the newly created chat <strong>Id</strong> when creating the system message.</p></li></ol><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.8/assets/images/create-new-chat-2-3346ae9a3ea18e33d4308d3be479c95b.png" width="1638" height="968" class="img_ev3q"></p></div><ol start="3"><li>Then we create a second message which is what we want the AI assistants first welcome message to be. You can edit the message by editing the properties of the <code>Create New Record</code> node. All messages have a <code>Role</code> and a <code>Content</code> property. The role can be one of <code>system</code>, <code>assistant</code>, <code>user</code> and the content contains the content of the message.</li></ol><div class="ndl-image-with-background l"><p><img loading="lazy" src="/2.8/assets/images/create-new-chat-3-c0fab5a5b423a5e5412f6994d67ffbf1.png" width="604" height="264" class="img_ev3q"></p></div><ol start="4"><li>Now we have the system message and the first message in place we can respond from the function. We make sure to send the <strong>Chat Id</strong> back so we can use this later in the frontend when sending new messages.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="send-message">Send message<a href="#send-message" class="hash-link" aria-label="Direct link to Send message" title="Direct link to Send message">​</a></h2><p>The second cloud function is <code>OpenAI/Send Message</code> and this is where we send new messages to the OpenAI API and store the response. The first part of the function looks like this:</p><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.8/assets/images/send-message-1-682a2289e2cd6d6589c26ac135eb1886.png" width="1596" height="776" class="img_ev3q"></p></div><ol><li><p>First we receive the content from the request and we create a new <code>OpenAIChatMessages</code> record with the new content, this time we set the role to <code>user</code>. Making sure we set the <code>Chat</code> pointer to the <strong>Chat Id</strong> supplied with the request.</p></li><li><p>Next we query all messages we have up until this point, using a query records node and the <strong> Chat Id</strong> we got with the request. These will be fed into the OpenAI API.</p></li></ol><div class="ndl-image-with-background xl"><p><img loading="lazy" src="/2.8/assets/images/send-message-2-b6787aa53a882b7b8ac43f6e8840dc17.png" width="1534" height="772" class="img_ev3q"></p></div><ol start="3"><li><p>Here we feed the chat message into the logic component <code>Chat Completion</code> that comes with the prefab. What this logic component does is that it asks OpenAI for the next message that should follow given the provided chat history.</p></li><li><p>When it succeeds we create a new <code>OpenAIChatMessages</code> record, this time with the role <code>assistant</code> and the content from the response we receive from OpenAI.</p></li><li><p>Now the function completed and the frontend updates by again fetching all messages in the chat.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="improvements">Improvements<a href="#improvements" class="hash-link" aria-label="Direct link to Improvements" title="Direct link to Improvements">​</a></h2><p>This prefab is meant to give you a starting point for building AI applications based on the OpenAI chat API. Here are a few pointers for how you can improve it.</p><ul><li><p>Somtimes the <code>Chat Completion</code> calls can take long and Noodl cloud functions have a timeout at 25s, but actually the keep running until completion and the message will be added to the database when completed. It can be an idea that if you get a timeout on the frontend to keep polling the database for a few seconds.</p></li><li><p>You can also just return the latest message an add it to the list on the frontend, so you don&#x27;t have to re-query the entire list every time a new message is added.</p></li><li><p>There is also a logic component called <code>Completion</code> that uses the prompt completion API that OpenAI provides.</p></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#create-new-chat" class="table-of-contents__link toc-highlight">Create new chat</a></li><li><a href="#send-message" class="table-of-contents__link toc-highlight">Send message</a></li><li><a href="#improvements" class="table-of-contents__link toc-highlight">Improvements</a></li></ul></div></div></div></div></div></main></div></div></div>
<script src="/2.8/assets/js/runtime~main.a64c9ce0.js"></script>
<script src="/2.8/assets/js/main.91e3c642.js"></script>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P4LSJL4" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) --></body>
</html>