"use strict";(self.webpackChunknew_noodl_docs=self.webpackChunknew_noodl_docs||[]).push([[4505],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),m=o,h=u["".concat(l,".").concat(m)]||u[m]||d[m]||i;return n?a.createElement(h,r(r({ref:t},c),{},{components:n})):a.createElement(h,r({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},53488:function(e,t,n){n.d(t,{Z:function(){return i}});var a=n(67294);function o(e){navigator.clipboard?navigator.clipboard.writeText(e).then((function(){console.log("Async: Copying to clipboard was successful!")}),(function(e){console.error("Async: Could not copy text: ",e)})):function(e){var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{var n=document.execCommand("copy")?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+n)}catch(a){console.error("Fallback: Oops, unable to copy",a)}document.body.removeChild(t)}(e)}function i(e){return a.createElement("button",{className:"ndl-copy-nodes-button",onClick:function(){return t=e.json,void o(JSON.stringify(t));var t}})}},17213:function(e,t,n){n.d(t,{Z:function(){return i}});var a=n(67294),o=n(39671);function i(e){var t=e.zip,n=e.name,i=e.thumb,r=e.cf;return a.createElement("button",{className:"ndl-import-button",onClick:function(){return(0,o.I)(t,{name:n,thumb:i,cf:r})}})}},39671:function(e,t,n){n.d(t,{I:function(){return o}});var a=n(99782);function o(e,t){var n=[];t&&void 0!==t.name&&n.push("name="+encodeURIComponent(t.name)),t&&void 0!==t.thumb&&n.push("thumb="+encodeURIComponent(location.protocol+"//"+location.host+a.default.baseUrl+t.thumb)),t&&void 0!==t.cf&&n.push("cf="+encodeURIComponent(location.protocol+"//"+location.host+a.default.baseUrl+"/"+t.cf));var o="noodl:import/"+location.protocol+"//"+location.host+a.default.baseUrl+e+(n.length>0?"?"+n.join("&"):"");console.log("Importing into Noodl:",o),console.log(e),window.location.href=o}},34119:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return c},default:function(){return g},frontMatter:function(){return p},metadata:function(){return d},toc:function(){return m}});var a=n(83117),o=n(80102),i=(n(67294),n(3905)),r=n(53488),s=n(17213),l=["components"],p={title:"Building Business Logic Using Javascript",hide_title:!0},c="Client Side Business Logic Using Javascript",d={unversionedId:"guides/business-logic/client-side-biz-logic-js",id:"guides/business-logic/client-side-biz-logic-js",title:"Building Business Logic Using Javascript",description:"What you will learn in this guide",source:"@site/docs/guides/business-logic/client-side-biz-logic-js.mdx",sourceDirName:"guides/business-logic",slug:"/guides/business-logic/client-side-biz-logic-js",permalink:"/2.6/docs/guides/business-logic/client-side-biz-logic-js",tags:[],version:"current",frontMatter:{title:"Building Business Logic Using Javascript",hide_title:!0},sidebar:"docsSidebar",previous:{title:"Javascript in Noodl",permalink:"/2.6/docs/guides/business-logic/javascript"},next:{title:"Custom UI Components",permalink:"/2.6/docs/guides/business-logic/custom-ui-components"}},u={},m=[{value:"What you will learn in this guide",id:"what-you-will-learn-in-this-guide",level:2},{value:"Overview",id:"overview",level:2},{value:"Creating a list with multiselect UI",id:"creating-a-list-with-multiselect-ui",level:2},{value:"The base data",id:"the-base-data",level:2},{value:"Building a Multi Select List",id:"building-a-multi-select-list",level:2},{value:"Selection logic",id:"selection-logic",level:3},{value:"Setter functions - execute code when an input changes",id:"setter-functions---execute-code-when-an-input-changes",level:2},{value:"Checking for <code>undefined</code> inputs",id:"checking-for-undefined-inputs",level:3},{value:"Using a Component Object in your scripts",id:"using-a-component-object-in-your-scripts",level:2},{value:"Making the List Items",id:"making-the-list-items",level:2},{value:"Triggering Signals in a Script",id:"triggering-signals-in-a-script",level:2},{value:"Array outputs used in lists",id:"array-outputs-used-in-lists",level:2},{value:"Timing of signals",id:"timing-of-signals",level:2},{value:"Sending signals from a script",id:"sending-signals-from-a-script",level:2},{value:"Finishing off the Multi Select List",id:"finishing-off-the-multi-select-list",level:2},{value:"Adding in the multi select operations",id:"adding-in-the-multi-select-operations",level:2},{value:"More Component Objects",id:"more-component-objects",level:2},{value:"Using Function node for lightweight scripting",id:"using-function-node-for-lightweight-scripting",level:2},{value:"Implementing the list operations",id:"implementing-the-list-operations",level:2}],h={toc:m};function g(e){var t=e.components,p=(0,o.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},h,p,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"client-side-business-logic-using-javascript"},"Client Side Business Logic Using Javascript"),(0,i.kt)("h2",{id:"what-you-will-learn-in-this-guide"},"What you will learn in this guide"),(0,i.kt)("p",null,"This guide shows how you use Javascript to implement business logic on the client (front-end) side of your app. While you can build business logic with a no-code approach using logic nodes (as described in ",(0,i.kt)("a",{parentName:"p",href:"/docs/guides/business-logic/client-side-biz-logic-nodes"},"this guide"),") its often easier to use Javascript since business logic sometimes is more readable in code form. In this guide we will  make use of the ",(0,i.kt)("a",{parentName:"p",href:"/nodes/javascript/function"},"Function")," and ",(0,i.kt)("a",{parentName:"p",href:"/nodes/javascript/script"},"Script")," nodse which are the main way to mix code and no-code in Noodl.\nAnother important node is the ",(0,i.kt)("a",{parentName:"p",href:"/nodes/component-utilities/component-object"},"Component Object")," that's the main way of storing state data so it can be accessed easily both in the code world and the node world."),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)("p",null,"The guide will implement a simple multiselect interaction on a list and a few multiselect operations, such as delete and copy. The business logic will handle the multi-select itself (selecting, deselecting) as well as the operations on the content in the list. It will also control the state of ",(0,i.kt)("strong",{parentName:"p"},"Buttons")," on the screen."),(0,i.kt)("p",null,"We will use various Noodl concepts, such as lists, Arrays and Objects, so it's probably good if you have gone through those guides before ( ",(0,i.kt)("a",{parentName:"p",href:"/docs/guides/data/list-basics"},"List guide"),", ",(0,i.kt)("a",{parentName:"p",href:"/docs/guides/data/arrays"},"Array guide")," and ",(0,i.kt)("a",{parentName:"p",href:"/docs/guides/data/objects"},"Object guide"),"). We will also use Javascript of course, and especially many Array functions, so that's worth checking out as well. A good documentation can be found for example ",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array"},"here"),". "),(0,i.kt)("p",null,"There is also a dedicated guide on the ",(0,i.kt)("strong",{parentName:"p"},"Script")," node, ",(0,i.kt)("a",{parentName:"p",href:"/docs/guides/business-logic/javascript"},"here"),"."),(0,i.kt)("h2",{id:"creating-a-list-with-multiselect-ui"},"Creating a list with multiselect UI"),(0,i.kt)("p",null,"This example will revolve around a simple collection of orders, for example in a e-commerce system. The orders have an ",(0,i.kt)("inlineCode",{parentName:"p"},"order_nbr"),", a ",(0,i.kt)("inlineCode",{parentName:"p"},"quantity")," and a ",(0,i.kt)("inlineCode",{parentName:"p"},"delivery_date"),". The App should list the orders and let the user select a number of them, using a standard multi select interaction. Then the selected orders can either be ",(0,i.kt)("em",{parentName:"p"},"deleted"),", ",(0,i.kt)("em",{parentName:"p"},"copied")," or ",(0,i.kt)("em",{parentName:"p"},"merged"),". We will look what the actual operations mean in more detail as we implement them. It's also possible to ",(0,i.kt)("em",{parentName:"p"},"select all")," or ",(0,i.kt)("em",{parentName:"p"},"deselect all")," items."),(0,i.kt)("h2",{id:"the-base-data"},"The base data"),(0,i.kt)("p",null,"We start this guide by adding in our base dataset that we want to work on. We are going to use the ",(0,i.kt)("a",{parentName:"p",href:"/nodes/data/array/static-array"},"Static Array"),' to keep our data, but in essence this data could have come from a cloud database. So start a new project, using the "Hello World" template. Then add a ',(0,i.kt)("strong",{parentName:"p"},"Static Array")," node, set it to ",(0,i.kt)("inlineCode",{parentName:"p"},"JSON")," format, and add in the following data:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'[   \n    {"order_nbr":"A-12124", "quantity":2, "delivery_date":"2022-10-23"},\n    {"order_nbr":"A-26232", "quantity":6, "delivery_date":"2022-10-25"},\n    {"order_nbr":"V-23532", "quantity":3, "delivery_date":"2022-09-13"},\n    {"order_nbr":"B-99243", "quantity":5, "delivery_date":"2022-08-03"},\n    {"order_nbr":"V-35124", "quantity":1, "delivery_date":"2022-12-20"},\n    {"order_nbr":"G-23421", "quantity":1, "delivery_date":"2022-09-09"},\n    {"order_nbr":"B-86612", "quantity":8, "delivery_date":"2022-11-21"},\n    {"order_nbr":"C-61633", "quantity":5, "delivery_date":"2022-05-29"},\n    {"order_nbr":"V-42241", "quantity":2, "delivery_date":"2022-11-15"},\n    {"order_nbr":"V-99112", "quantity":12, "delivery_date":"2022-12-20"},\n    {"order_nbr":"A-51512", "quantity":1, "delivery_date":"2022-07-07"},\n    {"order_nbr":"B-00914", "quantity":8, "delivery_date":"2022-09-13"},\n    {"order_nbr":"C-11121", "quantity":9, "delivery_date":"2022-10-19"}\n]\n')),(0,i.kt)("p",null,"Now we have some orders in the system so ket's start building the UI. We will start with the multi select list."),(0,i.kt)("h2",{id:"building-a-multi-select-list"},"Building a Multi Select List"),(0,i.kt)("p",null,"We want to build a component that can show an array of items, as well as keeping track of which items that are selected. Let's outline the functionality of it below"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"You should be able to feed it with items that will be shown in the list, with a checkbox in front of them"),(0,i.kt)("li",{parentName:"ul"},"You should be able to feed it an initial selection, i.e. which items that should be selected"),(0,i.kt)("li",{parentName:"ul"},"As you selected or deselect items, the component should trigger a signal and also provide an ",(0,i.kt)("strong",{parentName:"li"},"Array")," with the items that are currently selected"),(0,i.kt)("li",{parentName:"ul"},"You should be able to select or deselect all items by triggering a signal")),(0,i.kt)("p",null,"A question is how the multi select list would encode which items that are selected. One way of doing it would be that the multiselect list would provide an ",(0,i.kt)("strong",{parentName:"p"},"Array")," of items of format:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "Value":<id of selected object>\n}\n')),(0,i.kt)("p",null,'So for example, if the list has three items, with ids "111", "222" and "333". If the first and second item are selected, the output from the component would be:'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'[\n    {\n        "Value":"111"\n    },\n    {\n        "Value":"222"\n    }\n]\n')),(0,i.kt)("p",null,"So, when we are done, the component would look something like below from the outside:"),(0,i.kt)("div",{className:"ndl-image-with-background"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(53842).Z,width:"650",height:"402"}))),(0,i.kt)("h3",{id:"selection-logic"},"Selection logic"),(0,i.kt)("p",null,"Let's think about the logic needed by the component. Internally the component would need to keep track of which items that are selected and which are not. Partly to be able to generate the ",(0,i.kt)("strong",{parentName:"p"},"Array")," above, but also to be able to visualize it correctly."),(0,i.kt)("p",null,"You could of course store the selection state directly in the item, i.e. an order in our case, but that's actually not a great design. What would happen if the order was part of multiple Multi Select lists? Also, if we end up storing the item in the database we might also store the selection state if we are not careful, which doesn't make sense at all."),(0,i.kt)("p",null,'A better design is to "wrap" the each order in another ',(0,i.kt)("strong",{parentName:"p"},"Object"),' that keeps track of the selection state. Then we display a list of those objects when we present the list instead of the original items. The "wrapper" of course needs to store the ',(0,i.kt)("strong",{parentName:"p"},"Id")," of the ",(0,i.kt)("strong",{parentName:"p"},"Object")," that it wraps so it can present the data from the item too. The format of the wrapper could be:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'[\n    {\n        "Checked":<true or false depending if the item is checked or not>,\n        "Value":<the id of the Object it wraps>\n    }\n]\n')),(0,i.kt)("p",null,'So, again in the example above with the items with id "111", "222" and "333", with the first two checked, the Checkbox array would look like the following:'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'[\n    {\n        "Checked":true,\n        "Value":"111"\n    },\n    {\n        "Checked":true,\n        "Value":"222"\n    },\n    {\n        "Checked":false,\n        "Value":"333"\n    },\n]\n')),(0,i.kt)("p",null,"So in summary our Multi Select list component will need the following logic on the inside"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"When the list is fed with new items, it will create one new Checkbox Array containing an ",(0,i.kt)("strong",{parentName:"li"},"Object")," per item (the wrapper) and set ",(0,i.kt)("inlineCode",{parentName:"li"},"Checked")," to ",(0,i.kt)("inlineCode",{parentName:"li"},"true")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"false")," depending on initial selection."),(0,i.kt)("li",{parentName:"ul"},"The list item presenting each item will use the ",(0,i.kt)("inlineCode",{parentName:"li"},"Checked")," property to visualize the checked status of the item. If the user clicks the checkbox the ",(0,i.kt)("inlineCode",{parentName:"li"},"Checked")," property is toggled."),(0,i.kt)("li",{parentName:"ul"},"Whenever the checked status changes, the Multi Select List should generete a new list that only holds the items that are checked, according to the format above, i.e. ",(0,i.kt)("inlineCode",{parentName:"li"},'[{"Value":<id of a checked item>}, ...]'),". This will be presented to the outside world.")),(0,i.kt)("p",null,'Start by creating a new visual component. Call it "Multi Select List".'),(0,i.kt)("div",{className:"ndl-image-with-background"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(37380).Z,width:"885",height:"780"}))),(0,i.kt)("p",null,"You will now have a more or less empty component. Add in a ",(0,i.kt)("strong",{parentName:"p"},"Component Inputs")," and a ",(0,i.kt)("strong",{parentName:"p"},"Component Outputs"),". We now what they should contain are already, i.e. how to interact with our component. So in the ",(0,i.kt)("strong",{parentName:"p"},"Component Inputs")," add the ports ",(0,i.kt)("inlineCode",{parentName:"p"},"Selection"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Items"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Select All")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Clear Selection"),"."),(0,i.kt)("div",{className:"ndl-image-with-background"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(64340).Z,width:"717",height:"472"}))),(0,i.kt)("p",null,"In the ",(0,i.kt)("strong",{parentName:"p"},"Component Outputs")," we create the ports ",(0,i.kt)("inlineCode",{parentName:"p"},"Selection")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Selection Changed"),". "),(0,i.kt)("div",{className:"ndl-image-with-background"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(33656).Z,width:"720",height:"282"}))),(0,i.kt)("p",null,"Now we begin writing our Javascript logic. Add a ",(0,i.kt)("strong",{parentName:"p"},"Script")," node. "),(0,i.kt)("div",{className:"ndl-image-with-background"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(23525).Z,width:"1522",height:"700"}))),(0,i.kt)("p",null,"We begin by adding two inputs, one is the ",(0,i.kt)("inlineCode",{parentName:"p"},"Items")," that the list should display. The other is the ",(0,i.kt)("inlineCode",{parentName:"p"},"InitialSelection")," that contains any items that should be selected initially by the list. Both of these are of ",(0,i.kt)("inlineCode",{parentName:"p"},"Array")," type."),(0,i.kt)("div",{className:"ndl-image-with-background"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(71454).Z,width:"687",height:"960"}))),(0,i.kt)("p",null,"Ok, let's start coding! The first thing we want to do is to generate our Checkbox list, i.e. the ",(0,i.kt)("strong",{parentName:"p"},"Array")," of wrapping ",(0,i.kt)("strong",{parentName:"p"},"Objects")," that hold the checked state of each item."),(0,i.kt)("h2",{id:"setter-functions---execute-code-when-an-input-changes"},"Setter functions - execute code when an input changes"),(0,i.kt)("p",null,"We want to generate that ",(0,i.kt)("strong",{parentName:"p"},"Array")," any time the ",(0,i.kt)("inlineCode",{parentName:"p"},"Items")," input changes. If you want to execute a piece of script any time a specific input changes you can use a ",(0,i.kt)("em",{parentName:"p"},"Setter")," function. These are declared using the following format:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"Script.Setters.<property name> = function (value) {...}\n")),(0,i.kt)("p",null,"In our case we want to generate the Checkbox ",(0,i.kt)("strong",{parentName:"p"},"Array")," whenever ",(0,i.kt)("strong",{parentName:"p"},"Items")," is changed so we add the follwing code in our script file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"Script.Setters.Items = function (items) {\n    if(!Script.Inputs.Items) return \n    // Create a list of all items with checked status, based on the initial selection array\n    Component.Object.Checkboxes = Script.Inputs.Items.map(o => Noodl.Object.create({\n        id:Component.Object.id+'-'+o.id,\n        Value:o.id,\n        Checked:Script.Inputs.InitialSelection!==undefined && !!Script.Inputs.InitialSelection.find(s => s.Value === o.id)\n    })) \n}\n")),(0,i.kt)("p",null,"This code goes through the incoming ",(0,i.kt)("strong",{parentName:"p"},"Items")," (referred to through ",(0,i.kt)("inlineCode",{parentName:"p"},"Script.Inputs.Items"),"), and for each item creates a new wrapper ",(0,i.kt)("strong",{parentName:"p"},"Object")," (using ",(0,i.kt)("inlineCode",{parentName:"p"},"Noodl.Object.create"),"). It checks the checked state and sets either ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"false")," against the initial selection array. It also stores a pointer to the wrapped ",(0,i.kt)("strong",{parentName:"p"},"Object")," in the property ",(0,i.kt)("inlineCode",{parentName:"p"},"Value"),"."),(0,i.kt)("h3",{id:"checking-for-undefined-inputs"},"Checking for ",(0,i.kt)("inlineCode",{parentName:"h3"},"undefined")," inputs"),(0,i.kt)("p",null,"If an input of a script node hasn't been set yet, for example in the case of our ",(0,i.kt)("inlineCode",{parentName:"p"},"Items")," input or ",(0,i.kt)("inlineCode",{parentName:"p"},"InitialSelection")," here, they will have the value ",(0,i.kt)("inlineCode",{parentName:"p"},"undefined"),". It's often a good idea to explicitly check for this case in your code."),(0,i.kt)("p",null,"Another little trick here is that we explicitly set the ",(0,i.kt)("strong",{parentName:"p"},"id")," of the wrapper ",(0,i.kt)("strong",{parentName:"p"},"Object"),". This is actually not needed, as Noodl will generate a new ",(0,i.kt)("strong",{parentName:"p"},"id")," if no ",(0,i.kt)("strong",{parentName:"p"},"id")," is specified. But by making up an ",(0,i.kt)("strong",{parentName:"p"},"id")," of our own, that will be unique but the same for every wrapper object that wraps a specific object, we will reuse old ",(0,i.kt)("strong",{parentName:"p"},"Objects")," rather than creating new."),(0,i.kt)("p",null,"As you can see, the resulting ",(0,i.kt)("strong",{parentName:"p"},"Array")," is stored in ",(0,i.kt)("inlineCode",{parentName:"p"},"Component.Object.Checkboxes"),". This we should pay some extra attention to."),(0,i.kt)("h2",{id:"using-a-component-object-in-your-scripts"},"Using a Component Object in your scripts"),(0,i.kt)("p",null,"Each component in Noodl have a ",(0,i.kt)("strong",{parentName:"p"},"Component Object")," that's unique. Opposite to a regular ",(0,i.kt)("strong",{parentName:"p"},"Object")," a ",(0,i.kt)("strong",{parentName:"p"},"Component Object")," ",(0,i.kt)("em",{parentName:"p"},"can only be accessed by the component itself, or by children of the component using ",(0,i.kt)("strong",{parentName:"em"},"Parent Component Objects")),". This creates a scope and you does not risk other components accessing this object by mistake. For example if you would show two Multi Select lists on the same screen, if you used a regular ",(0,i.kt)("strong",{parentName:"p"},"Object")," to store your Checkboxes, you would need to make sure the ",(0,i.kt)("strong",{parentName:"p"},"Objects")," had unique ids (the Checkboxes can be different in the two lists). We avoid this problem all togheter by storing our Checkboxes in our ",(0,i.kt)("strong",{parentName:"p"},"Component Object"),"."),(0,i.kt)("p",null,"All components have a Component Object, and you can access it in the Node world by adding a ",(0,i.kt)("strong",{parentName:"p"},"Component Object")," node. So close the ",(0,i.kt)("strong",{parentName:"p"},"Script")," node for now, and add in a ",(0,i.kt)("strong",{parentName:"p"},"Component Object")," node. Also add the property ",(0,i.kt)("strong",{parentName:"p"},"Checkboxes")," on the ",(0,i.kt)("strong",{parentName:"p"},"Component Object"),"."),(0,i.kt)("p",null,"While we are at it we also connect the two outputs from ",(0,i.kt)("strong",{parentName:"p"},"Component Inputs")," (",(0,i.kt)("inlineCode",{parentName:"p"},"Items")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Selection"),") to ",(0,i.kt)("strong",{parentName:"p"},"Items")," and ",(0,i.kt)("strong",{parentName:"p"},"Initial Selection")," inputs on the ",(0,i.kt)("strong",{parentName:"p"},"Script")," node."),(0,i.kt)("div",{className:"ndl-image-with-background l"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(55359).Z,width:"1530",height:"635"}))),(0,i.kt)("p",null,"Let's test what we done so far, so we add in an ",(0,i.kt)("strong",{parentName:"p"},"Array")," node and connect the ",(0,i.kt)("strong",{parentName:"p"},"Checkboxes")," property of the ",(0,i.kt)("strong",{parentName:"p"},"Component Object")," to it (through the ",(0,i.kt)("strong",{parentName:"p"},"Items")," property). Next, we add in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Multi Select List")," component into our main App. Give it some items by connecting the ",(0,i.kt)("strong",{parentName:"p"},"Static Array")," items to it. If all is set up correctly, you should see some Checkbox items flowing into the ",(0,i.kt)("strong",{parentName:"p"},"Array"),"."),(0,i.kt)("div",{className:"ndl-image-with-background l"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(27619).Z,width:"2315",height:"997"}))),(0,i.kt)("h2",{id:"making-the-list-items"},"Making the List Items"),(0,i.kt)("p",null,"Now we are ready to create the List Items. Let's package up our ",(0,i.kt)("inlineCode",{parentName:"p"},"Multi Select List")," components into a folder. So create a new folder, call it ",(0,i.kt)("inlineCode",{parentName:"p"},"Multi Select List"),". Move our ",(0,i.kt)("inlineCode",{parentName:"p"},"Multi Select List")," component into it. Then add another visual component. Call it ",(0,i.kt)("inlineCode",{parentName:"p"},"List Item"),"."),(0,i.kt)("div",{className:"ndl-image-with-background"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(88308).Z,width:"677",height:"372"}))),(0,i.kt)("p",null,"We keep the list item visually simple. A horizontal layout with a ",(0,i.kt)("a",{parentName:"p",href:"/nodes/ui-controls/checkbox"},"Checkbox")," and three texts. Add some padding and margins to make it a little prettier. If you want, you can copy and paste the nodes into your component."),(0,i.kt)("div",{className:"ndl-image-with-background l"},(0,i.kt)(r.Z,{json:{nodes:[{id:"5c3f112c-604f-5c89-f500-bf8c79701ebc",type:"Group",x:-106,y:-21,parameters:{flexDirection:"row",paddingTop:{value:10,unit:"px"},paddingBottom:{value:10,unit:"px"},paddingLeft:{value:10,unit:"px"},paddingRight:{value:10,unit:"px"},sizeMode:"contentHeight"},ports:[],children:[{id:"8bfcaedb-94c0-e145-f973-5627c4adc2c8",type:"net.noodl.controls.checkbox",x:-86,y:25,parameters:{useLabel:!1,marginRight:{value:9,unit:"px"}},ports:[],children:[]},{id:"4abf508d-30fd-8273-0b5c-1c43ffc761fb",type:"Text",label:"Order nr",x:-86,y:71,parameters:{},ports:[],children:[]},{id:"66a0a3b1-f67c-37fe-26ab-47df859823e7",type:"Text",label:"Quantity",x:-86,y:131,parameters:{},ports:[],children:[]},{id:"80e557b6-964a-a9bb-87d4-13b4bf7ee1d5",type:"Text",label:"Delivery date",x:-86,y:191,parameters:{},ports:[],children:[]}]}],connections:[],comments:[]},mdxType:"CopyToClipboardButton"}),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(88063).Z,width:"900",height:"1385"}))),(0,i.kt)("p",null,"Then we hook up the data. We need to keep two ",(0,i.kt)("strong",{parentName:"p"},"Objects")," in mind this time. We have the ",(0,i.kt)("strong",{parentName:"p"},"Object")," providede by the ",(0,i.kt)("strong",{parentName:"p"},"Repeater"),' - the "wrapper", and the actual order. We hook it up like below. We also add a ',(0,i.kt)("strong",{parentName:"p"},"Component Output")," to we can know if a Checkbox was clicked."),(0,i.kt)("div",{className:"ndl-image-with-background l"},(0,i.kt)(r.Z,{json:{nodes:[{id:"176161a9-4c47-55e4-411e-73235b45899a",type:"Group",x:-106,y:-21,parameters:{flexDirection:"row",paddingTop:{value:10,unit:"px"},paddingBottom:{value:10,unit:"px"},paddingLeft:{value:10,unit:"px"},paddingRight:{value:10,unit:"px"},sizeMode:"contentHeight"},ports:[],children:[{id:"383c1752-5771-22f5-1334-160bdc0a7d99",type:"net.noodl.controls.checkbox",x:-86,y:25,parameters:{useLabel:!1,marginRight:{value:9,unit:"px"}},ports:[],children:[]},{id:"484c1964-a75f-c9f2-cdb9-2544a4b215d7",type:"Text",label:"Order nr",x:-86,y:127,parameters:{},ports:[],children:[]},{id:"cbe0804c-f3d2-e3bc-8773-ed005e88d4f8",type:"Text",label:"Quantity",x:-86,y:223,parameters:{},ports:[],children:[]},{id:"68fdebf1-67ee-702f-23cb-21d5b240f3a2",type:"Text",label:"Delivery date",x:-86,y:319,parameters:{},ports:[],children:[]}]},{id:"739ecad6-ec0f-9f2b-aeaa-4bae353e7570",type:"Model2",label:"Wrapper",x:-583.3416811729484,y:163.33900090176894,parameters:{idSource:"foreach",properties:"Checked,Value"},ports:[],children:[]},{id:"5e697dd5-760b-b449-dcbd-1bd2629cc786",type:"Component Outputs",x:455.8443558682088,y:170.21729798352135,parameters:{},ports:[{name:"Selection Changed",plug:"input",type:{name:"*"},index:1}],children:[]},{id:"cdd8417c-4d43-2bbe-aaa9-e23a22c8fb04",type:"SetModelProperties",x:208.84435586820882,y:169.21729798352135,parameters:{properties:"Checked"},ports:[],children:[]},{id:"0b1e1592-c722-9af7-9903-206b05af8cdd",type:"Model2",label:"Order",x:-321.1860370411575,y:104.12170291824759,parameters:{properties:"order_nbr,quantity,delivery_date"},ports:[],children:[]}],connections:[{fromId:"739ecad6-ec0f-9f2b-aeaa-4bae353e7570",fromProperty:"id",toId:"cdd8417c-4d43-2bbe-aaa9-e23a22c8fb04",toProperty:"modelId"},{fromId:"739ecad6-ec0f-9f2b-aeaa-4bae353e7570",fromProperty:"prop-Checked",toId:"383c1752-5771-22f5-1334-160bdc0a7d99",toProperty:"checked"},{fromId:"383c1752-5771-22f5-1334-160bdc0a7d99",fromProperty:"checked",toId:"cdd8417c-4d43-2bbe-aaa9-e23a22c8fb04",toProperty:"prop-Checked"},{fromId:"383c1752-5771-22f5-1334-160bdc0a7d99",fromProperty:"onChange",toId:"cdd8417c-4d43-2bbe-aaa9-e23a22c8fb04",toProperty:"store"},{fromId:"cdd8417c-4d43-2bbe-aaa9-e23a22c8fb04",fromProperty:"stored",toId:"5e697dd5-760b-b449-dcbd-1bd2629cc786",toProperty:"Selection Changed"},{fromId:"739ecad6-ec0f-9f2b-aeaa-4bae353e7570",fromProperty:"prop-Value",toId:"0b1e1592-c722-9af7-9903-206b05af8cdd",toProperty:"modelId"},{fromId:"0b1e1592-c722-9af7-9903-206b05af8cdd",fromProperty:"prop-order_nbr",toId:"484c1964-a75f-c9f2-cdb9-2544a4b215d7",toProperty:"text"},{fromId:"0b1e1592-c722-9af7-9903-206b05af8cdd",fromProperty:"prop-quantity",toId:"cbe0804c-f3d2-e3bc-8773-ed005e88d4f8",toProperty:"text"},{fromId:"0b1e1592-c722-9af7-9903-206b05af8cdd",fromProperty:"prop-delivery_date",toId:"68fdebf1-67ee-702f-23cb-21d5b240f3a2",toProperty:"text"}],comments:[]},mdxType:"CopyToClipboardButton"}),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(42265).Z,width:"2727",height:"1135"}))),(0,i.kt)("p",null,"We add in a ",(0,i.kt)("strong",{parentName:"p"},"Repeater")," node in our ",(0,i.kt)("inlineCode",{parentName:"p"},"Multi Select List")," component, pick our newly created list item as the item template. Finally we connect the ",(0,i.kt)("strong",{parentName:"p"},"Checkboxes")," output on our ",(0,i.kt)("strong",{parentName:"p"},"Component Object")," to the ",(0,i.kt)("strong",{parentName:"p"},"Items")," input of the repeater. We have a list!"),(0,i.kt)("div",{className:"ndl-image-with-background l"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(27619).Z,width:"2315",height:"997"}))),(0,i.kt)("h2",{id:"triggering-signals-in-a-script"},"Triggering Signals in a Script"),(0,i.kt)("p",null,"Now it's time that we write the script that will generate our selection list, i.e. an ",(0,i.kt)("strong",{parentName:"p"},"Array")," that will contain all the items that are currently checked. As you may remember, we decided on this format:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "Value":<id of selected object>\n}\n')),(0,i.kt)("p",null,"We go back into our Multiselect Logic Script node and start by adding in a new function. Call it ",(0,i.kt)("inlineCode",{parentName:"p"},"updateSelection"),". It will look like below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'function updateSelection () {\n    Component.Object.Selection = Component.Object.Checkboxes.filter(o => o.Checked)\n    .map(o => Noodl.Object.create({\n            id:Component.Object.id+"_"+o.Value,\n            Value:o.Value}\n    ));\n}\n')),(0,i.kt)("p",null,"Again, we are using our ",(0,i.kt)("strong",{parentName:"p"},"Component Object")," to store our ",(0,i.kt)("strong",{parentName:"p"},"Array"),". The ",(0,i.kt)("strong",{parentName:"p"},"Array")," is generated by walking through the Checkboxes ",(0,i.kt)("strong",{parentName:"p"},"Array")," and look for checked items. We then make a new ",(0,i.kt)("strong",{parentName:"p"},"Object")," (or recycling an old one if the ",(0,i.kt)("strong",{parentName:"p"},"id")," already exists) storing the ",(0,i.kt)("strong",{parentName:"p"},"id")," of the checked item in ",(0,i.kt)("strong",{parentName:"p"},"Value"),"."),(0,i.kt)("h2",{id:"array-outputs-used-in-lists"},"Array outputs used in lists"),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"While you can re-use the ",(0,i.kt)("strong",{parentName:"p"},"Array")," that contains the old items and just modify it, this will not be recognized as a change by the ",(0,i.kt)("strong",{parentName:"p"},"Repeater")," node (or any other node for that matter) and not automatically trigger it to update. Technically the ",(0,i.kt)("strong",{parentName:"p"},"Array")," didn't change - only it's contents. That's why it's important that you actually make a new ",(0,i.kt)("strong",{parentName:"p"},"Array")," and assigning it to the output, rather than modifying the existing one, unless you want to manually trigger ",(0,i.kt)("strong",{parentName:"p"},"Repeaters")," etc, using the ",(0,i.kt)("strong",{parentName:"p"},"Array")," to update. Generally the Javascript Array functions (filter, map, find, etc) will return new ",(0,i.kt)("strong",{parentName:"p"},"Arrays")," which makes them very easy to use in these cases."))),(0,i.kt)("p",null,"We actually need to call ",(0,i.kt)("inlineCode",{parentName:"p"},"updateSelection")," in our Setter function for ",(0,i.kt)("inlineCode",{parentName:"p"},"Items")," from before so right after we created the ",(0,i.kt)("strong",{parentName:"p"},"Checkboxes")," Array, so we immedieately get the Selection ",(0,i.kt)("strong",{parentName:"p"},"Array")," set up. So we update it like below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"Script.Setters.Items = function (items) {\n    if(!Script.Inputs.Items) return \n    // Create a lits of all checked items, based on the initial selection array\n    Component.Object.Checkboxes = Script.Inputs.Items.map(o => Noodl.Object.create({\n        id:Component.Object.id+'-'+o.id,\n        Value:o.id,\n        Checked:Script.Inputs.InitialSelection!==undefined && !!Script.Inputs.InitialSelection.find(s => s.Value === o.id)\n    })) \n\n    updateSelection ();\n}\n")),(0,i.kt)("p",null,"We also need to be able to trigger the ",(0,i.kt)("inlineCode",{parentName:"p"},"updateSelection")," whenever a user clicks a checkbox, regenerating the list. We can add ",(0,i.kt)("strong",{parentName:"p"},"signals")," to our scripts by writing ",(0,i.kt)("inlineCode",{parentName:"p"},"Script.Signals.<Signal name>"),". These signals will become inputs on the ",(0,i.kt)("strong",{parentName:"p"},"Script")," node that we can trigger. So our signal be named ",(0,i.kt)("inlineCode",{parentName:"p"},"UpdateSelection")," and will look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"Script.Signals.UpdateSelection = function () {\n    updateSelection ();\n}\n")),(0,i.kt)("p",null,"We can now connect the outgoing signal ",(0,i.kt)("inlineCode",{parentName:"p"},"Selection Changed")," from our ",(0,i.kt)("strong",{parentName:"p"},"Repeater")," (which is triggered from the ",(0,i.kt)("strong",{parentName:"p"},"Checkbox")," in the list item) to this new signal. We also connect the ",(0,i.kt)("inlineCode",{parentName:"p"},"Selections")," ",(0,i.kt)("strong",{parentName:"p"},"Array")," in our ",(0,i.kt)("strong",{parentName:"p"},"Component Object")," to our ",(0,i.kt)("strong",{parentName:"p"},"Component Output")," in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Multi Select List"),"."),(0,i.kt)("div",{className:"ndl-image-with-background l"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(2462).Z,width:"1835",height:"860"}))),(0,i.kt)("p",null,"Try clicking different Checkboxes and you should see the ",(0,i.kt)("inlineCode",{parentName:"p"},"Selection")," ",(0,i.kt)("strong",{parentName:"p"},"Array")," change accordingly."),(0,i.kt)("h2",{id:"timing-of-signals"},"Timing of signals"),(0,i.kt)("p",null,"There is a timing aspect that's important to look into. Our ",(0,i.kt)("inlineCode",{parentName:"p"},"Multi Select List")," should send out an event whenever the selection changes, together with the new selection array. If we directly connect the ",(0,i.kt)("inlineCode",{parentName:"p"},"Selection Changed")," signal from the ",(0,i.kt)("strong",{parentName:"p"},"Repeater")," node to the ",(0,i.kt)("strong",{parentName:"p"},"Component Output")," we cannot be certain that the ",(0,i.kt)("strong",{parentName:"p"},"Script")," node has executed once the signal is triggered. It may or may not be the case. So anyone listening to the ",(0,i.kt)("strong",{parentName:"p"},"Selection Changed")," signal of the ",(0,i.kt)("inlineCode",{parentName:"p"},"Multi Select List")," that also reads the new selection ( a very likely case) may read the previous ",(0,i.kt)("strong",{parentName:"p"},"Array"),"."),(0,i.kt)("p",null,"The solution is to chain these events. The ",(0,i.kt)("strong",{parentName:"p"},"Selection Changed")," event should trigger the ",(0,i.kt)("inlineCode",{parentName:"p"},"UpdateSelection")," signal on the ",(0,i.kt)("strong",{parentName:"p"},"Script")," node, then once the new selection ",(0,i.kt)("strong",{parentName:"p"},"Array")," is generated we need to send a signal from the ",(0,i.kt)("strong",{parentName:"p"},"Script")," that then will be used as the output signal from the component."),(0,i.kt)("h2",{id:"sending-signals-from-a-script"},"Sending signals from a script"),(0,i.kt)("p",null,"Let's add that signal. Click on the ",(0,i.kt)("strong",{parentName:"p"},"Script")," node. Then add a new output. Call it ",(0,i.kt)("inlineCode",{parentName:"p"},"SelectionChanged"),"."),(0,i.kt)("div",{className:"ndl-image-with-background"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(11096).Z,width:"1050",height:"1002"}))),(0,i.kt)("p",null,"Then make sure it's set up as a ",(0,i.kt)("strong",{parentName:"p"},"Signal"),"."),(0,i.kt)("div",{className:"ndl-image-with-background"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(61658).Z,width:"710",height:"1167"}))),(0,i.kt)("p",null,"Now we can send the signal from within our ",(0,i.kt)("strong",{parentName:"p"},"Script")," by calling it as a function ",(0,i.kt)("inlineCode",{parentName:"p"},"Script.Outputs.<signal name> ()"),". In our case we add it in i our ",(0,i.kt)("inlineCode",{parentName:"p"},"updateSelection")," function, as below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'Component.Object.Selection = Component.Object.Checkboxes.filter(o => o.Checked)\n    .map(o => Noodl.Object.create({\n            id:Component.Object.id+"_"+o.Value,\n            Value:o.Value}\n    ));\n    Script.Outputs.SelectionChanged ();\n')),(0,i.kt)("p",null,"We can now connect our new output ",(0,i.kt)("inlineCode",{parentName:"p"},"SelectionChanged")," to the ",(0,i.kt)("inlineCode",{parentName:"p"},"Selection Changed")," input on the ",(0,i.kt)("strong",{parentName:"p"},"Component Outputs"),"."),(0,i.kt)("div",{className:"ndl-image-with-background l"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(9158).Z,width:"1850",height:"847"}))),(0,i.kt)("h2",{id:"finishing-off-the-multi-select-list"},"Finishing off the Multi Select List"),(0,i.kt)("p",null,"The only thing left now is to implement the Select all / Clear selection functionality. This will be very easily done. We add two more incoming signals in our ",(0,i.kt)("strong",{parentName:"p"},"Scrip")," node, ",(0,i.kt)("inlineCode",{parentName:"p"},"Script.Signals.SelectAll")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Script.Signals.DeselectAll"),"."),(0,i.kt)("p",null,"Adding implementing them in our ",(0,i.kt)("strong",{parentName:"p"},"Script")," node is easy and the full code now looks like below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function updateSelection () {\n    Component.Object.Selection = Component.Object.Checkboxes.filter(o => o.Checked)\n    .map(o => Noodl.Object.create({\n            id:Component.Object.id+\"_\"+o.Value,\n            Value:o.Value}\n    ));\n    Script.Outputs.SelectionChanged ();\n}\n\nScript.Setters.Items = function (items) {\n    if(!Script.Inputs.Items) return \n    // Create a lits of all checked items, based on the initial selection array\n    Component.Object.Checkboxes = Script.Inputs.Items.map(o => Noodl.Object.create({\n        id:Component.Object.id+'-'+o.id,\n        Value:o.id,\n        Checked:Script.Inputs.InitialSelection!==undefined && !!Script.Inputs.InitialSelection.find(s => s.Value === o.id)\n    })) \n\n    updateSelection ();\n}\n\nScript.Signals.UpdateSelection = function () {\n    updateSelection ();\n}\n\nScript.Signals.SelectAll = function () {\n    if(!Component.Object.Checkboxes) return \n\n    Component.Object.Checkboxes.forEach ( o => o.Checked = true);\n    updateSelection ();\n}\n\nScript.Signals.DeselectAll = function () {\n    if(!Component.Object.Checkboxes) return\n\n    Component.Object.Checkboxes.forEach ( o => o.Checked = false);\n    updateSelection ();\n}\n")),(0,i.kt)("p",null,"We of course also need to trigger these functions from the ",(0,i.kt)("strong",{parentName:"p"},"Component Inputs")," ports, ",(0,i.kt)("inlineCode",{parentName:"p"},"Select All")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Clear Selection"),"."),(0,i.kt)("div",{className:"ndl-image-with-background l"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(69697).Z,width:"1690",height:"842"}))),(0,i.kt)("p",null,"We are done with the multi select list. Time to build the multi select operations we want to use it for."),(0,i.kt)("h2",{id:"adding-in-the-multi-select-operations"},"Adding in the multi select operations"),(0,i.kt)("p",null,"As described in the beginning, we want to implement the operations ",(0,i.kt)("em",{parentName:"p"},"merge"),", ",(0,i.kt)("em",{parentName:"p"},"delete")," and ",(0,i.kt)("em",{parentName:"p"},"copy"),". We also want to be able to select all or clear all selections. So we need to build some UI. We will create a top bar that consist of a ",(0,i.kt)("strong",{parentName:"p"},"Checkbox")," and three ",(0,i.kt)("strong",{parentName:"p"},"Buttons"),". We do it as simple as possible. A horizontally laid out ",(0,i.kt)("strong",{parentName:"p"},"Group")," node with some margins and padding to make it easy to read. You can copy the nodes below if you don't want to build it yourself."),(0,i.kt)("div",{className:"ndl-image-with-background l"},(0,i.kt)(r.Z,{json:{nodes:[{id:"d4c94e36-5463-a399-9dd0-69778d1236d8",type:"Group",label:"Top Bar",x:20,y:46,parameters:{flexDirection:"row",sizeMode:"contentSize",alignX:"left",marginBottom:{value:10,unit:"px"},paddingLeft:{value:10,unit:"px"}},ports:[],children:[{id:"3aceb58c-1d9e-6511-d418-de806a995c4c",type:"net.noodl.controls.checkbox",x:40,y:106,parameters:{useLabel:!1,alignY:"center",marginRight:{value:10,unit:"px"}},ports:[],children:[]},{id:"0544f9ec-a773-5093-5b5c-296a800ee3fb",type:"net.noodl.controls.button",label:"Delete",x:40,y:152,parameters:{marginRight:{value:10,unit:"px"},label:"Delete"},ports:[],children:[]},{id:"7d8801c3-c828-8956-0feb-f78ae9599de9",type:"net.noodl.controls.button",label:"Merge",x:40,y:212,parameters:{marginRight:{value:10,unit:"px"},label:"Merge"},ports:[],children:[]},{id:"01ef643f-ccfb-1242-8155-47f4d1dfc9cf",type:"net.noodl.controls.button",label:"Copy",x:40,y:272,parameters:{label:"Copy"},ports:[],children:[]}]}],connections:[],comments:[]},mdxType:"CopyToClipboardButton"}),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(23297).Z,width:"2430",height:"1285"}))),(0,i.kt)("p",null,"We can now connect the Select and Clear selection logic to our multi select list. We will use a ",(0,i.kt)("strong",{parentName:"p"},"Switch")," to trigger the two signals we implemented."),(0,i.kt)("div",{className:"ndl-image-with-background l"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(91632).Z,width:"2430",height:"1415"}))),(0,i.kt)("p",null,"We can now test out that our select all / clear selection implementation work as it should in our multi select list."),(0,i.kt)("h2",{id:"more-component-objects"},"More Component Objects"),(0,i.kt)("p",null,"In preparation for our upcoming script to implement the merge / copy / delete operations we need to save the selection state so we can easily access it in our Script. Again we will use a ",(0,i.kt)("strong",{parentName:"p"},"Component Object"),". For the actual storing operation of the selection we can use the node ",(0,i.kt)("a",{parentName:"p",href:"/nodes/component-utilities/set-component-object-properties"},"Set Component Object Properties"),". Add in the node and add a property ",(0,i.kt)("inlineCode",{parentName:"p"},"Selection"),". Set it to ",(0,i.kt)("strong",{parentName:"p"},"Array")," type."),(0,i.kt)("div",{className:"ndl-image-with-background l"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(25449).Z,width:"707",height:"605"}))),(0,i.kt)("p",null,"Then connect the outgoing ",(0,i.kt)("strong",{parentName:"p"},"Selection")," property from the ",(0,i.kt)("inlineCode",{parentName:"p"},"Multi Select List")," component to the property. We should set it everytime the selection changes, so we also connect ",(0,i.kt)("strong",{parentName:"p"},"Selection Changed")," to ",(0,i.kt)("strong",{parentName:"p"},"Do"),"."),(0,i.kt)("div",{className:"ndl-image-with-background l"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(98587).Z,width:"1830",height:"1427"}))),(0,i.kt)("h2",{id:"using-function-node-for-lightweight-scripting"},"Using Function node for lightweight scripting"),(0,i.kt)("p",null,"Our ",(0,i.kt)("strong",{parentName:"p"},"Buttons")," need a bit of business logic on their own. If you have no items selected the items should be disabled. And for the ",(0,i.kt)("em",{parentName:"p"},"merge")," operation to make sense you actually need at least two items selected."),(0,i.kt)("p",null,"If you want to write this in Javascript a ",(0,i.kt)("strong",{parentName:"p"},"Script")," node is a little heavy - we only are going to have one function. Instead we use the ",(0,i.kt)("strong",{parentName:"p"},"Function")," node."),(0,i.kt)("p",null,"So add in a ",(0,i.kt)("strong",{parentName:"p"},"Function")," node in our main app. Call it ",(0,i.kt)("inlineCode",{parentName:"p"},"Calculate Button States"),". Also add three outputs called ",(0,i.kt)("inlineCode",{parentName:"p"},"DeleteEnabled"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"CopyEnabled")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"MergeEnabled"),". They should be of ",(0,i.kt)("strong",{parentName:"p"},"Boolean")," type, because we want to connect them directly to the ",(0,i.kt)("strong",{parentName:"p"},"Enabled")," property of the ",(0,i.kt)("strong",{parentName:"p"},"Buttons"),"."),(0,i.kt)("div",{className:"ndl-image-with-background"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(4582).Z,width:"712",height:"1080"}))),(0,i.kt)("p",null,"The we open up the ",(0,i.kt)("strong",{parentName:"p"},"Function")," node and just write the code directly. In a ",(0,i.kt)("strong",{parentName:"p"},"Function")," node you don't have to write anything but your actual code, i.e. no function declarations etc is necessary."),(0,i.kt)("p",null,"Our code looks like below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"Outputs.CopyEnabled = Component.Object.Selection !== undefined && Component.Object.Selection.length > 0;\nOutputs.DeleteEnabled = Component.Object.Selection !== undefined && Component.Object.Selection.length > 0;\nOutputs.MergeEnabled = Component.Object.Selection !== undefined && Component.Object.Selection.length > 1;\n")),(0,i.kt)("p",null,"As you can see you access the outputs using ",(0,i.kt)("inlineCode",{parentName:"p"},"Outputs.<output name>")," and inputs (if we had to use one) are accessed through ",(0,i.kt)("inlineCode",{parentName:"p"},"Inputs.<input name>"),". You can also see that we make use of the ",(0,i.kt)("strong",{parentName:"p"},"Component Object")," again."),(0,i.kt)("p",null,"A ",(0,i.kt)("strong",{parentName:"p"},"Function")," node runs whenever an input changes, ",(0,i.kt)("em",{parentName:"p"},"unless the ",(0,i.kt)("strong",{parentName:"em"},"Run")," signal is connected in which case it only runs whtn ",(0,i.kt)("strong",{parentName:"em"},"Run")," is triggered"),". In our case, we have no inputs, so we need to trigger ",(0,i.kt)("strong",{parentName:"p"},"Run"),". To make sure ",(0,i.kt)("inlineCode",{parentName:"p"},"Component.Object.Selection")," is valid and set when we trigger it, we connect the outgoing ",(0,i.kt)("strong",{parentName:"p"},"Done")," from ",(0,i.kt)("strong",{parentName:"p"},"Set Component Object Properties")," to ",(0,i.kt)("strong",{parentName:"p"},"Run"),". We also hook up the outputs from the ",(0,i.kt)("strong",{parentName:"p"},"Function")," node to the ",(0,i.kt)("strong",{parentName:"p"},"Buttons"),"."),(0,i.kt)("div",{className:"ndl-image-with-background l"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(1262).Z,width:"1400",height:"1502"}))),(0,i.kt)("p",null,"Try out the logic and make sure the ",(0,i.kt)("strong",{parentName:"p"},"Buttons")," gets enabled/disabled as they should."),(0,i.kt)("h2",{id:"implementing-the-list-operations"},"Implementing the list operations"),(0,i.kt)("p",null,"We are almost done. We just need to implement the actual operations in a ",(0,i.kt)("strong",{parentName:"p"},"Script")," node. Before that we need to think a little bit about how we treat the ",(0,i.kt)("strong",{parentName:"p"},"Array")," that holds the items of the list. Currently we take the items directly from our ",(0,i.kt)("strong",{parentName:"p"},"Static Array"),". This will not work once we start modifying them, we need to store the ",(0,i.kt)("strong",{parentName:"p"},"Array")," somewhere where the ",(0,i.kt)("strong",{parentName:"p"},"Script")," can retrieve it, and then update to a new ",(0,i.kt)("strong",{parentName:"p"},"Array")," once a copy / delete / merge occurs."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Component Object")," to the rescue! Create a ",(0,i.kt)("strong",{parentName:"p"},"Component Object")," node and add a property ",(0,i.kt)("strong",{parentName:"p"},"Items"),". Then connect the ",(0,i.kt)("strong",{parentName:"p"},"Items")," from the ",(0,i.kt)("strong",{parentName:"p"},"Static Array")," to it. Also connect from the ",(0,i.kt)("strong",{parentName:"p"},"Component Object")," to the ",(0,i.kt)("inlineCode",{parentName:"p"},"Mult Select List")," component."),(0,i.kt)("div",{className:"ndl-image-with-background l"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(7509).Z,width:"1600",height:"1445"}))),(0,i.kt)("p",null,"We are now ready to write our list operation scripts. Add a new ",(0,i.kt)("strong",{parentName:"p"},"Script")," node. We implement our three functions below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"\n/* Returns a new array only continain the items that's selected */\nfunction getSelectedItems () {\n    if (Component.Object.Selection === undefined) {\n        // if there is no selection, return an empty array\n        return [];\n    }\n    else {\n        return Component.Object.Selection.map ( (o) => Noodl.Object.get (o.Value));\n    } \n}\n\n\n/* returns a new array containing all items \nexcept the ones that's selected */\n\nfunction removeSelectedItems () {\n    \n    return Component.Object.Items.filter ( (o) => {\n        // check if this item is in the selected list\n        if (Component.Object.Selection === undefined) {\n            // if there is no selection, the items should be kept in the list\n            return true;\n        }\n        else {\n            // check if this item is in the selected list. If it isn't return true (i.e. keep the item)\n            return Component.Object.Selection.find (p => (p.Value === o.id)) === undefined;\n        }\n    });\n}\n\n/*\nMerge all selected items into one item.\nUse the item with the latest date as the new item\ndelete the other items. */\n\nScript.Signals.Merge = function () {\n    if (Component.Object.Items !== undefined && Component.Object.Selection !== undefined) {\n        // start with looking at the items that's selected\n        let itemsToMerge = getSelectedItems();\n        // sort them by latest date\n        let sortedItems = itemsToMerge.sort ( (o,p) => {\n                return new Date (p.delivery_date) - new Date (o.delivery_date);\n            });\n        // the first item in the sorted list is the one we want to keep\n        let itemToKeep = sortedItems[0];\n\n        // calculate the sum of all quantities in the items to merge\n        let sumOfQuantities = sortedItems.reduce ( (total , o) => total + o.quantity, 0);\n        // and store in the item we want to keep\n        itemToKeep.quantity = sumOfQuantities;\n        // remove all items that's selected\n        let itemsToKeep = removeSelectedItems ();\n        // Add back the item to keep\n        itemsToKeep.push (itemToKeep);\n        // this is our new items!\n        Component.Object.Items = itemsToKeep;\n    }\n    \n}\n\nScript.Signals.Copy = function () {\n    if (Component.Object.Items !== undefined && Component.Object.Selection !== undefined) {\n        let selectedItems = getSelectedItems ();\n        // Get all selected items\n        // For each item in the selection, create a new object and copy the values\n        // Add a \"-2\" to the order_nbr\n        let copiedItems = selectedItems.map ( (o) => {\n            return Noodl.Object.create ({\n            order_nbr: o.order_nbr+\"-2\",\n            quantity: o.quantity,\n            delivery_date: o.delivery_date\n            });\n        });\n        Component.Object.Items = Component.Object.Items.concat (copiedItems);\n    }\n}\n\nScript.Signals.Delete = function () {\n     if (Component.Object.Items !== undefined && Component.Object.Selection !== undefined) {\n          Component.Object.Items = removeSelectedItems ();\n     }\n}\n")),(0,i.kt)("p",null,"Paste the code into the ",(0,i.kt)("strong",{parentName:"p"},"Script")," node. Again note that ",(0,i.kt)("inlineCode",{parentName:"p"},"Component.Object.Items")," is always replaced with a new ",(0,i.kt)("strong",{parentName:"p"},"Array")," - we never modify the old one. This is to ensure that the multi select list understand that it needs to update."),(0,i.kt)("p",null,"Finally we connect our ",(0,i.kt)("strong",{parentName:"p"},"Buttons")," to the respective list operation and we are done! "),(0,i.kt)("div",{className:"ndl-image-with-background xl"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(12925).Z,width:"2165",height:"1517"}))),(0,i.kt)("p",null,"You can import the full project below."),(0,i.kt)("div",{className:"ndl-image-with-background l"},(0,i.kt)("p",null,(0,i.kt)("img",{src:n(28438).Z,width:"922",height:"1640"})),(0,i.kt)(s.Z,{zip:"/docs/guides/business-logic/client-side-biz-logic-js/biz-logic-js.zip",name:"Multiselect list with js",thumb:"/docs/guides/business-logic/client-side-biz-logic-js/final-1.png",mdxType:"ImportButton"})))}g.isMDXComponent=!0},23297:function(e,t,n){t.Z=n.p+"assets/images/app-1-0d0a94989bf6b15d07cc0bb9a0757e40.png"},91632:function(e,t,n){t.Z=n.p+"assets/images/app-2-89b9c61311b917676359d1ef287870e6.png"},98587:function(e,t,n){t.Z=n.p+"assets/images/app-3-692d3008208c9865a462c5d93f4d1359.png"},1262:function(e,t,n){t.Z=n.p+"assets/images/app-4-cac4a21e6cac0a54206247f3bc3a2bda.png"},7509:function(e,t,n){t.Z=n.p+"assets/images/app-5-b4674cb6745eb6047efb85e871d44b6a.png"},12925:function(e,t,n){t.Z=n.p+"assets/images/app-6-a9bd9f97d998e729a0bf8a56116a6880.png"},37380:function(e,t,n){t.Z=n.p+"assets/images/component-1-f211b6270c42886eb2b3122303171b9c.png"},88308:function(e,t,n){t.Z=n.p+"assets/images/component-2-01590a4f630ae2b9eb93b37096b3593a.png"},64340:function(e,t,n){t.Z=n.p+"assets/images/component-inputs-1-00260bc124403c654d1f997f0ba0dc49.png"},25449:function(e,t,n){t.Z=n.p+"assets/images/component-object-prop-1-89f92ae68f2189a2518c6f0117a28564.png"},33656:function(e,t,n){t.Z=n.p+"assets/images/component-outputs-1-fc7428831662937b2053964f3bb03be7.png"},28438:function(e,t,n){t.Z=n.p+"assets/images/final-1-f5f2d196548b7a71e14c1497ea1e73be.png"},4582:function(e,t,n){t.Z=n.p+"assets/images/function-1-471c572a04ed1b217499908542442640.png"},88063:function(e,t,n){t.Z=n.p+"assets/images/listitem-1-17d73147906609b9f7a33e9d2f86dd8b.png"},42265:function(e,t,n){t.Z=n.p+"assets/images/listitem-2-d378dc341c229d4d56936303eeeaea64.png"},53842:function(e,t,n){t.Z=n.p+"assets/images/multiselect-list-1-769bddd8dcef92b44a50d38afc30c421.png"},23525:function(e,t,n){t.Z=n.p+"assets/images/multiselect-list-2-36b3218a550752fd57d8a5f4e1bb1cb4.png"},55359:function(e,t,n){t.Z=n.p+"assets/images/multiselect-list-3-1e29a11884bf61f6d557e3f2de4b9c28.png"},27619:function(e,t,n){t.Z=n.p+"assets/images/multiselect-list-4-76079ef1ce3e4e494f022d0c02a63cff.png"},2462:function(e,t,n){t.Z=n.p+"assets/images/multiselect-list-6-65ae508e04b880302dbe6b9ea5388b49.png"},9158:function(e,t,n){t.Z=n.p+"assets/images/multiselect-list-7-aeb26f3efefae3e8d8e89fbcf94efa79.png"},69697:function(e,t,n){t.Z=n.p+"assets/images/multiselect-list-8-17c833987feb86447fd059e43d59ba2b.png"},71454:function(e,t,n){t.Z=n.p+"assets/images/multiselect-script-1-359b38695020e57f16b709db40ef4e80.png"},11096:function(e,t,n){t.Z=n.p+"assets/images/script-1-48148c8218ebfdc41319f799e4bb6970.png"},61658:function(e,t,n){t.Z=n.p+"assets/images/script-2-06c5cef88ca7c6cdd63b32e31f46f469.png"}}]);